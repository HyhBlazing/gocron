webpackJsonp([1],{0:function(t,e){},"0pEU":function(t,e){},"5Teu":function(t,e){},BbYC:function(t,e){},"C/r1":function(t,e){},Eyp0:function(t,e){},NHnr:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=a("7+uW"),i=a("zL8q"),r=a.n(i),o=(a("tvR6"),a("BO1k")),n=a.n(o),l=a("//Fk"),c=a.n(l),u=a("mtWM"),d=a.n(u),p=a("/ocq"),m=a("NYxO"),v=a("Zrlr"),f=a.n(v),h=a("wxAW"),_=a.n(h),g=new(function(){function t(){f()(this,t)}return _()(t,[{key:"get",value:function(){return{token:this.getToken(),uid:this.getUid(),username:this.getUsername(),isAdmin:this.getIsAdmin()}}},{key:"getToken",value:function(){return localStorage.getItem("token")||""}},{key:"setToken",value:function(t){return localStorage.setItem("token",t),this}},{key:"clear",value:function(){localStorage.clear()}},{key:"getUid",value:function(){return localStorage.getItem("uid")||""}},{key:"setUid",value:function(t){return localStorage.setItem("uid",t),this}},{key:"getUsername",value:function(){return localStorage.getItem("username")||""}},{key:"setUsername",value:function(t){return localStorage.setItem("username",t),this}},{key:"getIsAdmin",value:function(){return"1"===localStorage.getItem("is_admin")}},{key:"setIsAdmin",value:function(t){return localStorage.setItem("is_admin",t),this}}]),t}());s.default.use(m.a);var b=new m.a.Store({state:{hiddenNavMenu:!1,user:g.get()},getters:{user:function(t){return t.user},login:function(t){return""!==t.user.token}},mutations:{hiddenNavMenu:function(t){t.hiddenNavMenu=!0},showNavMenu:function(t){t.hiddenNavMenu=!1},setUser:function(t,e){g.setToken(e.token),g.setUid(e.uid),g.setUsername(e.username),g.setIsAdmin(e.isAdmin),t.user=e},logout:function(t){g.clear(),t.user=g.get()}}}),k={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-dialog",{attrs:{title:"您访问的页面不存在",visible:t.dialogVisible,"close-on-click-modal":!1,"show-close":!1,"close-on-press-escape":!1},on:{"update:visible":function(e){t.dialogVisible=e}}},[a("el-button",{attrs:{type:"primary"},on:{click:t.jump}},[t._v("确定")])],1)},staticRenderFns:[]},y=a("VU/8")({name:"not-found",data:function(){return{dialogVisible:!0}},methods:{jump:function(){this.$router.push("/")}}},k,!1,null,null,null).exports,w=a("Dd8w"),C=a.n(w),x={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"dark-sidebar"},[a("nav",{staticClass:"dark-sidebar-nav"},[a("div",{staticClass:"dark-sidebar-section"},[a("div",{staticClass:"dark-sidebar-title"},[t._v("任务")]),t._v(" "),a("router-link",{staticClass:"dark-sidebar-item",class:{active:t.isActive("/task")},attrs:{to:"/task"}},[a("span",{staticClass:"dark-sidebar-label"},[t._v("所有定时")])]),t._v(" "),a("router-link",{staticClass:"dark-sidebar-item",class:{active:t.isActive("/task/log")},attrs:{to:"/task/log"}},[a("span",{staticClass:"dark-sidebar-label"},[t._v("定时日志")])])],1),t._v(" "),t.isAdmin?a("div",{staticClass:"dark-sidebar-divider"}):t._e(),t._v(" "),t.isAdmin?a("div",{staticClass:"dark-sidebar-section"},[a("div",{staticClass:"dark-sidebar-title"},[t._v("系统")]),t._v(" "),a("router-link",{staticClass:"dark-sidebar-item",class:{active:t.isActive("/system/notification")},attrs:{to:"/system/notification"}},[a("span",{staticClass:"dark-sidebar-label"},[t._v("通知配置")])]),t._v(" "),a("router-link",{staticClass:"dark-sidebar-item",class:{active:t.isActive("/host")},attrs:{to:"/host"}},[a("span",{staticClass:"dark-sidebar-label"},[t._v("节点管理")])]),t._v(" "),t.isAdmin?a("router-link",{staticClass:"dark-sidebar-item",class:{active:t.isActive("/user")},attrs:{to:"/user"}},[a("span",{staticClass:"dark-sidebar-label"},[t._v("用户管理")])]):t._e()],1):t._e(),t._v(" "),t.isAdmin?a("div",{staticClass:"dark-sidebar-divider"}):t._e(),t._v(" "),t.isAdmin?a("div",{staticClass:"dark-sidebar-section"},[a("div",{staticClass:"dark-sidebar-title"},[t._v("其他")]),t._v(" "),a("router-link",{staticClass:"dark-sidebar-item",class:{active:t.isActive("/system/login-log")},attrs:{to:"/system/login-log"}},[a("span",{staticClass:"dark-sidebar-label"},[t._v("登录日志")])]),t._v(" "),a("router-link",{staticClass:"dark-sidebar-item",class:{active:t.isActive("/system/stats")},attrs:{to:"/system/stats"}},[a("span",{staticClass:"dark-sidebar-label"},[t._v("统计")])])],1):t._e()])])},staticRenderFns:[]};var T=a("VU/8")({name:"task-sidebar",computed:{isAdmin:function(){return!(!this.$store.getters.user||!this.$store.getters.user.isAdmin)}},methods:{isActive:function(t){return this.$route.path===t}}},x,!1,function(t){a("5Teu")},"data-v-34fd3ece",null).exports,P=function(t,e,a){ne.batchGet([{uri:"/task",params:t},{uri:"/host/all"}],e,a)},S=function(t,e){ne.batchGet([{uri:"/task/"+t},{uri:"/host/all"}],e)},F=function(t,e){ne.post("/task/store",t,e)},$=function(t,e){ne.post("/task/remove/"+t,{},e)},L=function(t,e){ne.post("/task/enable/"+t,{},e)},R=function(t,e){ne.post("/task/disable/"+t,{},e)},M=function(t,e){ne.get("/task/run/"+t,{},e)},D=function(t,e,a){ne.get("/task/tags",t||{},e,a)},z=function(t,e,a){ne.get("/task/log",t,e,a)},V=function(t){ne.post("/task/log/clear",{},t)},E=function(t,e,a){ne.post("/task/log/stop",{id:t,task_id:e},a)},I=a("zm/z"),A=a.n(I);a("wfK6"),a("C/r1");function U(t){return t.getFullYear()+"-"+String(t.getMonth()+1).padStart(2,"0")+"-"+String(t.getDate()).padStart(2,"0")+" "+String(t.getHours()).padStart(2,"0")+":"+String(t.getMinutes()).padStart(2,"0")+":"+String(t.getSeconds()).padStart(2,"0")}var O={name:"task-list",data:function(){return{tasks:[],hosts:[],taskTotal:0,loading:!1,searchParams:{page_size:20,page:1,keyword:"",protocol:"",tag:"",host_id:"",status:""},isAdmin:!(!this.$store.getters.user||!this.$store.getters.user.isAdmin),protocolList:[{value:"1",label:"http"},{value:"2",label:"shell"}],statusList:[{value:"2",label:"激活"},{value:"1",label:"停止"}],detailDialogVisible:!1,detailTask:null,logDialogVisible:!1,logModalTask:null,logList:[],logTotal:0,logLoading:!1,logSearchParams:{page_size:20,page:1,task_id:"",status:""},logStatusList:[{value:"2",label:"执行"},{value:"3",label:"成功"},{value:"1",label:"失败"},{value:"4",label:"取消"}],cronRunsModalVisible:!1,cronRunsList:[],cronRunsError:"",cronRunsTitle:"",cronRunsIsEveryType:!1,logResultDialogVisible:!1,currentLogResult:{command:"",result:""},logDetailDialogVisible:!1,currentLogDetail:null,tagOptions:[],tagLoading:!1,searchTimer:null}},components:{taskSidebar:T},created:function(){var t=this.$route.query.host_id;t&&(this.searchParams.host_id=t),this.loadTags(),this.search()},beforeDestroy:function(){this.searchTimer&&clearTimeout(this.searchTimer)},filters:{formatLevel:function(t){return 1===t?"主定时":"子定时"},formatTimeout:function(t){return t>0?t+"秒":"不限制"},formatRetryTimesInterval:function(t){return t>0?t+"秒":"系统默认"},formatMulti:function(t){return t>0?"否":"是"}},methods:{copyTag:function(t){var e=this,a=(t||"").trim();if(a){var s=function(){return e.$message.success("标签已复制")},i=function(){return e.$message.error("复制失败，请手动复制")};if(navigator.clipboard&&navigator.clipboard.writeText)navigator.clipboard.writeText(a).then(s).catch(function(){try{var t=document.createElement("textarea");t.value=a,t.setAttribute("readonly","readonly"),t.style.position="fixed",t.style.top="-9999px",document.body.appendChild(t),t.select();var e=document.execCommand("copy");document.body.removeChild(t),e?s():i()}catch(t){i()}});else try{var r=document.createElement("textarea");r.value=a,r.setAttribute("readonly","readonly"),r.style.position="fixed",r.style.top="-9999px",document.body.appendChild(r),r.select();var o=document.execCommand("copy");document.body.removeChild(r),o?s():i()}catch(t){i()}}else this.$message.warning("标签内容为空")},copyCronSpec:function(t){var e=this,a=(t||"").trim();if(a){var s=function(){return e.$message.success("Cron 表达式已复制")},i=function(){return e.$message.error("复制失败，请手动复制")};if(navigator.clipboard&&navigator.clipboard.writeText)navigator.clipboard.writeText(a).then(s).catch(function(){try{var t=document.createElement("textarea");t.value=a,t.setAttribute("readonly","readonly"),t.style.position="fixed",t.style.top="-9999px",document.body.appendChild(t),t.select();var e=document.execCommand("copy");document.body.removeChild(t),e?s():i()}catch(t){i()}});else try{var r=document.createElement("textarea");r.value=a,r.setAttribute("readonly","readonly"),r.style.position="fixed",r.style.top="-9999px",document.body.appendChild(r),r.select();var o=document.execCommand("copy");document.body.removeChild(r),o?s():i()}catch(t){i()}}else this.$message.warning("Cron 表达式为空")},showCronRunsModal:function(t){var e=t&&t.spec?String(t.spec).trim():"";if(e){this.cronRunsTitle=t&&t.name?t.name:"定时",this.cronRunsList=[],this.cronRunsError="",this.cronRunsIsEveryType=!1,this.cronRunsModalVisible=!0;try{var a=e.match(/^@every\s+(.+)$/i);if(a){this.cronRunsIsEveryType=!0;var s=function(t){var e=0,a=t.match(/(\d+)h/);a&&(e+=36e5*parseInt(a[1],10));var s=t.match(/(\d+)m/);s&&(e+=6e4*parseInt(s[1],10));var i=t.match(/(\d+)s/);return i&&(e+=1e3*parseInt(i[1],10)),e}(a[1]);if(s<=0)return void(this.cronRunsError="无效的间隔时长");for(var i=Date.now(),r=1;r<=10;r++){var o=new Date(i+s*r);this.cronRunsList.push(U(o))}return}var n=function(t){var e=t.trim().split(/\s+/);return 5===e.length?e.join(" ")+" *":t}(e),l=A.a.parseExpression(n,{currentDate:new Date}).iterate(10);this.cronRunsList=l.map(function(t){return U(t)})}catch(t){this.cronRunsError=t&&t.message?t.message:"cron 表达式解析失败"}}else this.$message.warning("Cron 表达式为空")},getTagStyle:function(t){var e=(t||"").trim();if(!e)return{};for(var a=0,s=0;s<e.length;s++)a=(a<<5)-a+e.charCodeAt(s),a|=0;var i=Math.abs(a),r=i%360,o=58+i%18,n=94-(i>>5)%6;return{background:"hsl("+r+", "+o+"%, "+n+"%)",color:"hsl("+r+", "+o+"%, "+(32+(i>>3)%8)+"%)",border:"1px solid hsl("+r+", "+o+"%, "+(n-7)+"%)"}},formatTaskCreated:function(t){if(null===t||void 0===t)return"-";var e=String(t).trim();if(!e||"0"===e)return"-";var a=t;if(/^\d+$/.test(e)){var s=Number(e);if(!s)return"-";a=s<1e12?1e3*s:s}var i=new Date(a);if(isNaN(i.getTime())||i.getFullYear()<2e3)return"-";var r=function(t){return t>=10?t:"0"+t};return i.getFullYear()+"-"+r(i.getMonth()+1)+"-"+r(i.getDate())+" "+r(i.getHours())+":"+r(i.getMinutes())+":"+r(i.getSeconds())},isEverySpec:function(t){return t&&String(t).trim().toLowerCase().startsWith("@every")},isValidNextRunTime:function(t){return!!t&&(0!==String(t).indexOf("0001-01-01")&&new Date(t).getFullYear()>=2e3)},debouncedSearch:function(){var t=this;this.searchTimer&&clearTimeout(this.searchTimer),this.searchTimer=setTimeout(function(){t.searchParams.page=1,t.search()},400)},loadTags:function(){var t=this;this.tagLoading=!0,D({},function(e){t.tagOptions=Array.isArray(e)?e:[],t.tagLoading=!1},function(){t.tagLoading=!1})},changeStatus:function(t){var e=this,a=t.status?"定时已启用":"定时已停用";t.status?L(t.id,function(){e.$message.success(a)}):R(t.id,function(){e.$message.success(a)})},formatProtocol:function(t,e){return t?2===t[e.property]?"shell":1===t.http_method?"http-get":"http-post":""},changePage:function(t){this.searchParams.page=t,this.search()},changePageSize:function(t){this.searchParams.page_size=t,this.searchParams.page=1,this.search()},search:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.loading=!0,P(this.searchParams,function(a,s){t.tasks=a&&a.data?a.data:[],t.taskTotal=a&&null!=a.total?a.total:0,t.hosts=s&&Array.isArray(s)?s:[],t.loading=!1,"function"==typeof e&&e()},function(){t.loading=!1})},runTask:function(t){var e=this;this.$appConfirm(function(){M(t.id,function(){e.$message.success("定时已开始执行")})})},remove:function(t){var e=this;this.$appConfirm(function(){$(t.id,function(){e.refresh()})})},openDetail:function(t){this.detailTask=t,this.detailDialogVisible=!0},closeDetailModal:function(){this.detailTask=null},jumpToLog:function(t){this.logModalTask=t,this.logSearchParams={page_size:20,page:1,task_id:String(t.id),status:""},this.logDialogVisible=!0,this.searchLogs()},closeLogModal:function(){this.logModalTask=null,this.logList=[],this.logTotal=0},searchLogs:function(){var t=this;this.logModalTask&&(this.logLoading=!0,z(this.logSearchParams,function(e){t.logList=e.data||[],t.logTotal=e.total||0,t.logLoading=!1},function(){t.logLoading=!1}))},changeLogPage:function(t){this.logSearchParams.page=t,this.searchLogs()},changeLogPageSize:function(t){this.logSearchParams.page_size=t,this.logSearchParams.page=1,this.searchLogs()},showLogResult:function(t){this.currentLogResult={command:t.command||"",result:t.result||""},this.logResultDialogVisible=!0},showLogDetail:function(t){this.currentLogDetail=C()({},t),this.logDetailDialogVisible=!0},closeLogDetailDialog:function(){this.currentLogDetail=null},stopLogTask:function(t){var e=this;E(t.id,t.task_id,function(){e.searchLogs()})},openLogInNewWindow:function(){if(this.logModalTask){var t=this.$router.resolve({path:"/task/log",query:{task_id:this.logModalTask.id}});window.open(t.href,"_blank")}},refresh:function(){var t=this;this.search(function(){t.$message.success("刷新成功")})},toEdit:function(t){var e=null===t?"/task/create":"/task/edit/"+t.id,a=this.$router.resolve(e);window.open(a.href,"_blank")}}},q={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-container",[a("task-sidebar"),t._v(" "),a("el-main",{staticClass:"ios-task-page"},[a("div",{staticClass:"search-bar"},[a("div",{staticClass:"search-filters"},[a("el-input",{staticClass:"search-input",attrs:{placeholder:"定时ID/定时名称"},on:{input:t.debouncedSearch},nativeOn:{keyup:function(e){if(!("button"in e)&&t._k(e.keyCode,"enter",13,e.key,"Enter"))return null;t.search()}},model:{value:t.searchParams.keyword,callback:function(e){t.$set(t.searchParams,"keyword","string"==typeof e?e.trim():e)},expression:"searchParams.keyword"}}),t._v(" "),a("el-select",{staticClass:"search-select",attrs:{filterable:"",clearable:"",placeholder:"标签"},on:{change:t.debouncedSearch},model:{value:t.searchParams.tag,callback:function(e){t.$set(t.searchParams,"tag","string"==typeof e?e.trim():e)},expression:"searchParams.tag"}},t._l(t.tagOptions,function(t){return a("el-option",{key:t,attrs:{label:t,value:t}})})),t._v(" "),a("el-select",{staticClass:"search-select",on:{change:t.debouncedSearch},model:{value:t.searchParams.protocol,callback:function(e){t.$set(t.searchParams,"protocol","string"==typeof e?e.trim():e)},expression:"searchParams.protocol"}},[a("el-option",{attrs:{label:"全部执行方式",value:""}}),t._v(" "),t._l(t.protocolList,function(t){return a("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})],2),t._v(" "),a("el-select",{staticClass:"search-select",on:{change:t.debouncedSearch},model:{value:t.searchParams.host_id,callback:function(e){t.$set(t.searchParams,"host_id","string"==typeof e?e.trim():e)},expression:"searchParams.host_id"}},[a("el-option",{attrs:{label:"全部定时节点",value:""}}),t._v(" "),t._l(t.hosts,function(t){return a("el-option",{key:t.id,attrs:{label:t.alias+" - "+t.name+":"+t.port,value:t.id}})})],2),t._v(" "),a("el-select",{staticClass:"search-select",on:{change:t.debouncedSearch},model:{value:t.searchParams.status,callback:function(e){t.$set(t.searchParams,"status","string"==typeof e?e.trim():e)},expression:"searchParams.status"}},[a("el-option",{attrs:{label:"全部状态",value:""}}),t._v(" "),t._l(t.statusList,function(t){return a("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})],2)],1),t._v(" "),a("div",{staticClass:"search-actions"},[this.$store.getters.user.isAdmin?a("el-button",{staticClass:"ios-action-btn",attrs:{type:"primary",plain:""},on:{click:function(e){t.toEdit(null)}}},[t._v("新增定时")]):t._e(),t._v(" "),a("el-button",{staticClass:"ios-action-btn",attrs:{type:"primary",plain:""},on:{click:t.refresh}},[t._v("刷新")])],1)]),t._v(" "),a("div",{staticClass:"pagination-bar"},[a("span",{staticClass:"pagination-total"},[t._v("共 "+t._s(t.taskTotal)+" 条")]),t._v(" "),a("el-pagination",{staticClass:"ios-pagination",attrs:{background:"",layout:"prev, pager, next, jumper, sizes",total:t.taskTotal,"current-page":t.searchParams.page,"page-size":t.searchParams.page_size,"page-sizes":[10,20,50,100]},on:{"size-change":t.changePageSize,"current-change":t.changePage,"prev-click":t.changePage,"next-click":t.changePage}})],1),t._v(" "),a("div",{staticClass:"ios-table-card"},[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"task-list-table ios-data-table",staticStyle:{width:"100%"},attrs:{data:t.tasks,"tooltip-effect":"dark"}},[a("el-table-column",{attrs:{label:"定时名称","min-width":"180"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",{staticClass:"task-name-cell"},[a("div",{staticClass:"task-name-main"},[a("span",[t._v(t._s(e.row.name))]),t._v(" "),e.row.tag?a("el-tooltip",{attrs:{content:"点击复制标签",placement:"top"}},[a("span",{staticClass:"ios-tag ios-tag-clickable",style:t.getTagStyle(e.row.tag),attrs:{role:"button",tabindex:"0"},on:{click:function(a){a.stopPropagation(),t.copyTag(e.row.tag)},keydown:[function(a){if(!("button"in a)&&t._k(a.keyCode,"enter",13,a.key,"Enter"))return null;a.preventDefault(),t.copyTag(e.row.tag)},function(a){if(!("button"in a)&&t._k(a.keyCode,"space",32,a.key," "))return null;a.preventDefault(),t.copyTag(e.row.tag)}]}},[t._v(t._s(e.row.tag))])]):t._e()],1),t._v(" "),a("div",{staticClass:"task-meta-sub"},[a("el-tooltip",{attrs:{content:"创建时间",placement:"top"}},[a("span",{staticClass:"task-time-sub"},[t._v(t._s(t.formatTaskCreated(e.row.created)))])]),t._v(" "),a("el-tooltip",{attrs:{content:"定时ID",placement:"top"}},[a("span",{staticClass:"task-id-sub"},[t._v(t._s(e.row.id))])])],1)])]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"cron表达式",width:"200"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",{staticClass:"cron-cell"},[a("div",{staticClass:"cron-spec-wrap"},[a("el-tooltip",{attrs:{content:"点击查看未来 10 次执行时间",placement:"top"}},[a("span",{staticClass:"cron-spec-text",attrs:{role:"button",tabindex:"0"},on:{click:function(a){t.showCronRunsModal(e.row)},keydown:[function(a){if(!("button"in a)&&t._k(a.keyCode,"enter",13,a.key,"Enter"))return null;a.preventDefault(),t.showCronRunsModal(e.row)},function(a){if(!("button"in a)&&t._k(a.keyCode,"space",32,a.key," "))return null;a.preventDefault(),t.showCronRunsModal(e.row)}]}},[t._v(t._s(e.row.spec))])]),t._v(" "),a("button",{staticClass:"cron-copy-btn",attrs:{type:"button"},on:{click:function(a){a.stopPropagation(),t.copyCronSpec(e.row.spec)}}},[t._v("复制")])],1),t._v(" "),!t.isEverySpec(e.row.spec)&&t.isValidNextRunTime(e.row.next_run_time)?a("el-tooltip",{attrs:{content:"下次执行时间",placement:"top"}},[a("span",{staticClass:"ios-tag ios-tag-time"},[t._v(t._s(t._f("formatTime")(e.row.next_run_time)))])]):t._e()],1)]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"protocol",formatter:t.formatProtocol,width:"90",label:"执行方式"}}),t._v(" "),this.isAdmin?a("el-table-column",{attrs:{label:"状态",width:"70",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[1===e.row.level?a("el-switch",{attrs:{"active-value":1,"inactive-vlaue":0,"active-color":"#13ce66","inactive-color":"#ff4949"},on:{change:function(a){t.changeStatus(e.row)}},model:{value:e.row.status,callback:function(a){t.$set(e.row,"status",a)},expression:"scope.row.status"}}):t._e()]}}])}):a("el-table-column",{attrs:{label:"状态",width:"70",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[1===e.row.level?a("el-switch",{attrs:{"active-value":1,"inactive-vlaue":0,"active-color":"#13ce66",disabled:!0,"inactive-color":"#ff4949"},model:{value:e.row.status,callback:function(a){t.$set(e.row,"status",a)},expression:"scope.row.status"}}):t._e()]}}])}),t._v(" "),this.isAdmin?a("el-table-column",{attrs:{label:"操作",width:"360"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",{staticClass:"action-buttons"},[a("el-button",{attrs:{type:"info",size:"mini"},on:{click:function(a){t.openDetail(e.row)}}},[t._v("详情")]),t._v(" "),a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(a){t.toEdit(e.row)}}},[t._v("编辑")]),t._v(" "),a("el-button",{attrs:{type:"success",size:"mini"},on:{click:function(a){t.runTask(e.row)}}},[t._v("手动执行")]),t._v(" "),a("el-button",{attrs:{type:"info",size:"mini"},on:{click:function(a){t.jumpToLog(e.row)}}},[t._v("日志")]),t._v(" "),a("el-button",{attrs:{type:"danger",size:"mini"},on:{click:function(a){t.remove(e.row)}}},[t._v("删除")])],1)]}}])}):t._e()],1)],1),t._v(" "),a("div",{staticClass:"pagination-bar pagination-bar-bottom"},[a("span",{staticClass:"pagination-total"},[t._v("共 "+t._s(t.taskTotal)+" 条")]),t._v(" "),a("el-pagination",{staticClass:"ios-pagination",attrs:{background:"",layout:"prev, pager, next, jumper, sizes",total:t.taskTotal,"current-page":t.searchParams.page,"page-size":t.searchParams.page_size,"page-sizes":[10,20,50,100]},on:{"size-change":t.changePageSize,"current-change":t.changePage,"prev-click":t.changePage,"next-click":t.changePage}})],1),t._v(" "),a("el-dialog",{attrs:{title:"定时详情 - "+(t.detailTask?t.detailTask.name:""),visible:t.detailDialogVisible,width:"820px","custom-class":"task-detail-dialog","append-to-body":!0},on:{"update:visible":function(e){t.detailDialogVisible=e},close:t.closeDetailModal}},[t.detailTask?a("div",{staticClass:"task-expand-wrap"},[a("div",{staticClass:"task-expand-section task-expand-grid"},[t.detailTask.created?a("div",{staticClass:"task-expand-row"},[a("span",{staticClass:"task-expand-label"},[t._v("定时创建时间")]),t._v(" "),a("span",{staticClass:"task-expand-value"},[t._v(t._s(t._f("formatTime")(t.detailTask.created)))])]):t._e(),t._v(" "),a("div",{staticClass:"task-expand-row"},[a("span",{staticClass:"task-expand-label"},[t._v("定时类型")]),t._v(" "),a("span",{staticClass:"task-expand-value"},[t._v(t._s(t._f("formatLevel")(t.detailTask.level)))])]),t._v(" "),a("div",{staticClass:"task-expand-row"},[a("span",{staticClass:"task-expand-label"},[t._v("单实例运行")]),t._v(" "),a("span",{staticClass:"task-expand-value"},[t._v(t._s(t._f("formatMulti")(t.detailTask.multi)))])]),t._v(" "),a("div",{staticClass:"task-expand-row"},[a("span",{staticClass:"task-expand-label"},[t._v("超时时间")]),t._v(" "),a("span",{staticClass:"task-expand-value"},[t._v(t._s(t._f("formatTimeout")(t.detailTask.timeout)))])]),t._v(" "),a("div",{staticClass:"task-expand-row"},[a("span",{staticClass:"task-expand-label"},[t._v("重试次数")]),t._v(" "),a("span",{staticClass:"task-expand-value"},[t._v(t._s(t.detailTask.retry_times))])]),t._v(" "),a("div",{staticClass:"task-expand-row"},[a("span",{staticClass:"task-expand-label"},[t._v("重试间隔")]),t._v(" "),a("span",{staticClass:"task-expand-value"},[t._v(t._s(t._f("formatRetryTimesInterval")(t.detailTask.retry_interval)))])])]),t._v(" "),2===t.detailTask.protocol&&(t.detailTask.hosts||[]).length?a("div",{staticClass:"task-expand-section"},[a("div",{staticClass:"task-expand-row"},[a("span",{staticClass:"task-expand-label"},[t._v("定时节点")]),t._v(" "),a("span",{staticClass:"task-expand-value task-expand-value-block"},t._l(t.detailTask.hosts||[],function(e){return a("span",{key:e.host_id},[t._v(t._s(e.alias)+" - "+t._s(e.name)+":"+t._s(e.port))])}))])]):t._e(),t._v(" "),t.detailTask.command?a("div",{staticClass:"task-expand-section"},[a("div",{staticClass:"task-expand-row task-expand-row-full"},[a("span",{staticClass:"task-expand-label"},[t._v("命令")]),t._v(" "),a("span",{staticClass:"task-expand-value task-expand-value-code"},[t._v(t._s(t.detailTask.command))])])]):t._e(),t._v(" "),t.detailTask.remark?a("div",{staticClass:"task-expand-section"},[a("div",{staticClass:"task-expand-row task-expand-row-full"},[a("span",{staticClass:"task-expand-label"},[t._v("备注")]),t._v(" "),a("span",{staticClass:"task-expand-value"},[t._v(t._s(t.detailTask.remark))])])]):t._e()]):t._e()]),t._v(" "),a("el-dialog",{attrs:{title:"定时日志 - "+(t.logModalTask?t.logModalTask.name:""),visible:t.logDialogVisible,width:"1000px","custom-class":"log-modal-dialog","append-to-body":!0},on:{"update:visible":function(e){t.logDialogVisible=e},close:t.closeLogModal}},[t.logModalTask?a("div",{staticClass:"log-modal-content"},[a("div",{staticClass:"log-modal-toolbar"},[a("el-form",{attrs:{inline:!0,size:"small"},nativeOn:{submit:function(t){t.preventDefault()}}},[a("el-form-item",[a("el-select",{attrs:{placeholder:"全部状态",clearable:""},on:{change:t.searchLogs},model:{value:t.logSearchParams.status,callback:function(e){t.$set(t.logSearchParams,"status",e)},expression:"logSearchParams.status"}},[a("el-option",{attrs:{label:"全部状态",value:""}}),t._v(" "),t._l(t.logStatusList,function(t){return a("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})],2)],1),t._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"info",size:"small"},on:{click:t.searchLogs}},[a("i",{staticClass:"el-icon-refresh",class:{"is-loading":t.logLoading}}),t._v("\n                刷新\n              ")])],1),t._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"text",size:"small"},on:{click:t.openLogInNewWindow}},[t._v("新窗口打开")])],1)],1)],1),t._v(" "),a("div",{staticClass:"log-modal-pagination"},[a("span",{staticClass:"pagination-total"},[t._v("共 "+t._s(t.logTotal)+" 条")]),t._v(" "),a("el-pagination",{attrs:{small:"",background:"",layout:"prev, pager, next, sizes",total:t.logTotal,"page-sizes":[10,20,50],"page-size":t.logSearchParams.page_size,"current-page":t.logSearchParams.page},on:{"size-change":t.changeLogPageSize,"current-change":t.changeLogPage}})],1),t._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.logLoading,expression:"logLoading"}],staticClass:"log-modal-table",attrs:{data:t.logList,border:"",size:"small","max-height":"400"}},[a("el-table-column",{attrs:{prop:"id",label:"日志ID",width:"80"}}),t._v(" "),a("el-table-column",{attrs:{label:"执行时间","min-width":"200"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",{staticClass:"time-info"},[a("span",[t._v(t._s(t._f("formatTime")(e.row.start_time)))]),t._v(" "),1!==e.row.status?a("span",[t._v("~ "+t._s(t._f("formatTime")(e.row.end_time)))]):t._e(),t._v(" "),a("div",{staticClass:"duration"},[t._v("耗时: "+t._s(e.row.total_time>0?e.row.total_time:1)+"s")])])]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"状态",width:"90"},scopedSlots:t._u([{key:"default",fn:function(e){return[0===e.row.status?a("el-tag",{attrs:{type:"danger",size:"mini"}},[t._v("失败")]):1===e.row.status?a("el-tag",{attrs:{type:"primary",size:"mini"}},[t._v("执行")]):2===e.row.status?a("el-tag",{attrs:{type:"success",size:"mini"}},[t._v("成功")]):3===e.row.status?a("el-tag",{attrs:{type:"info",size:"mini"}},[t._v("取消")]):t._e()]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"操作",width:"240",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",{staticClass:"action-buttons",staticStyle:{"justify-content":"center"}},[a("el-button",{attrs:{size:"mini",type:"info",plain:""},on:{click:function(a){t.showLogDetail(e.row)}}},[t._v("详情")]),t._v(" "),2===e.row.status||0===e.row.status?a("el-button",{attrs:{size:"mini",type:"primary",plain:""},on:{click:function(a){t.showLogResult(e.row)}}},[t._v("结果")]):t._e(),t._v(" "),1===e.row.status&&2===e.row.protocol?a("el-button",{attrs:{size:"mini",type:"danger",plain:""},on:{click:function(a){t.stopLogTask(e.row)}}},[t._v("停止定时")]):t._e()],1)]}}])})],1)],1):t._e()]),t._v(" "),a("el-dialog",{attrs:{title:"定时执行详情",visible:t.logResultDialogVisible,width:"800px","custom-class":"result-dialog ios-result-dialog","append-to-body":!0},on:{"update:visible":function(e){t.logResultDialogVisible=e}}},[a("div",{staticClass:"result-content"},[a("div",{staticClass:"result-section"},[a("div",{staticClass:"section-label"},[t._v("执行命令")]),t._v(" "),a("div",{staticClass:"code-container command"},[a("code",[t._v(t._s(t.currentLogResult.command))])])]),t._v(" "),a("div",{staticClass:"result-section"},[a("div",{staticClass:"section-label"},[t._v("输出结果")]),t._v(" "),a("div",{staticClass:"code-container output"},[a("pre",[t._v(t._s(t.currentLogResult.result||"无输出结果"))])])])])]),t._v(" "),a("el-dialog",{attrs:{title:"日志详情",visible:t.logDetailDialogVisible,width:"760px","custom-class":"task-detail-dialog","append-to-body":!0},on:{"update:visible":function(e){t.logDetailDialogVisible=e},close:t.closeLogDetailDialog}},[t.currentLogDetail?a("div",{staticClass:"task-expand-wrap"},[a("div",{staticClass:"task-expand-section task-expand-grid"},[a("div",{staticClass:"task-expand-row"},[a("span",{staticClass:"task-expand-label"},[t._v("日志ID")]),t._v(" "),a("span",{staticClass:"task-expand-value"},[t._v(t._s(t.currentLogDetail.id))])]),t._v(" "),a("div",{staticClass:"task-expand-row"},[a("span",{staticClass:"task-expand-label"},[t._v("定时ID")]),t._v(" "),a("span",{staticClass:"task-expand-value"},[t._v(t._s(t.currentLogDetail.task_id))])]),t._v(" "),a("div",{staticClass:"task-expand-row"},[a("span",{staticClass:"task-expand-label"},[t._v("重试次数")]),t._v(" "),a("span",{staticClass:"task-expand-value"},[t._v(t._s(t.currentLogDetail.retry_times))])])]),t._v(" "),a("div",{staticClass:"task-expand-section"},[a("div",{staticClass:"task-expand-row task-expand-row-full"},[a("span",{staticClass:"task-expand-label"},[t._v("Cron表达式")]),t._v(" "),a("span",{staticClass:"task-expand-value task-expand-value-code"},[t._v(t._s(t.currentLogDetail.spec||"-"))])])]),t._v(" "),a("div",{staticClass:"task-expand-section"},[a("div",{staticClass:"task-expand-row task-expand-row-full"},[a("span",{staticClass:"task-expand-label"},[t._v("执行命令")]),t._v(" "),a("span",{staticClass:"task-expand-value task-expand-value-code"},[t._v(t._s(t.currentLogDetail.command||"-"))])])])]):t._e()]),t._v(" "),a("el-dialog",{attrs:{title:"未来执行时间 - "+t.cronRunsTitle,visible:t.cronRunsModalVisible,width:"520px","custom-class":"task-detail-dialog","append-to-body":!0},on:{"update:visible":function(e){t.cronRunsModalVisible=e}}},[a("div",{staticClass:"cron-runs-content"},[t.cronRunsIsEveryType?a("p",{staticClass:"cron-runs-tip"},[t._v("根据当前时间计算，可能与实际执行时间略有差异。")]):t._e(),t._v(" "),t.cronRunsList.length?a("div",{staticClass:"cron-runs-list"},t._l(t.cronRunsList,function(e,s){return a("div",{key:s,staticClass:"cron-runs-item"},[a("span",{staticClass:"cron-runs-index"},[t._v(t._s(s+1))]),t._v(" "),a("span",{staticClass:"cron-runs-time"},[t._v(t._s(e))])])})):a("div",{staticClass:"cron-runs-empty"},[t._v(t._s(t.cronRunsError||"暂无数据"))])])])],1)],1)},staticRenderFns:[]};var N=a("VU/8")(O,q,!1,function(t){a("0pEU")},"data-v-37719787",null).exports,j=function(t){ne.get("/system/mail",{},t)},H=function(t,e){ne.post("/system/mail/update",t,e)},W=function(t,e){ne.post("/system/mail/user",t,e)},B=function(t,e){ne.post("/system/mail/user/remove/"+t,{},e)},Y=function(t){ne.get("/system/webhook",{},t)},J=function(t,e){ne.post("/system/webhook/update",t,e)};function G(t){return t.getFullYear()+"-"+String(t.getMonth()+1).padStart(2,"0")+"-"+String(t.getDate()).padStart(2,"0")+" "+String(t.getHours()).padStart(2,"0")+":"+String(t.getMinutes()).padStart(2,"0")+":"+String(t.getSeconds()).padStart(2,"0")}var Z={name:"task-edit",data:function(){return{form:{id:"",name:"",tag:"",level:1,dependency_status:1,dependency_task_id:"",spec:"",protocol:2,http_method:1,command:"",host_id:"",timeout:0,multi:2,notify_status:1,notify_type:2,notify_receiver_id:"",notify_keyword:"",retry_times:0,retry_interval:0,remark:""},cronSpecModalVisible:!1,cronSpecActiveTab:"basic",nextRunsModalVisible:!1,nextRunsList:[],nextRunsError:"",nextRunsIsEveryType:!1,dependencyTooltipContent:"1. 强依赖：主定时执行成功，才会运行子定时\n2. 弱依赖：无论主定时执行是否成功，都会运行子定时",formRules:{name:[{required:!0,message:"请输入定时名称",trigger:"blur"}],spec:[{required:!0,message:"请输入crontab表达式",trigger:"blur"}],command:[{required:!0,message:"请输入命令",trigger:"blur"}],timeout:[{type:"number",required:!0,message:"请输入有效的定时超时时间",trigger:"blur"}],retry_times:[{type:"number",required:!0,message:"请输入有效的定时执行失败重试次数",trigger:"blur"}],retry_interval:[{type:"number",required:!0,message:"请输入有效的定时执行失败，重试间隔时间",trigger:"blur"}],notify_keyword:[{required:!0,message:"请输入要匹配的定时执行输出关键字",trigger:"blur"}]},httpMethods:[{value:1,label:"get"},{value:2,label:"post"}],protocolList:[{value:1,label:"http"},{value:2,label:"shell"}],levelList:[{value:1,label:"主定时"},{value:2,label:"子定时"}],dependencyStatusList:[{value:1,label:"强依赖"},{value:2,label:"弱依赖"}],runStatusList:[{value:2,label:"是"},{value:1,label:"否"}],notifyStatusList:[{value:1,label:"不通知"},{value:2,label:"失败通知"},{value:3,label:"总是通知"},{value:4,label:"关键字匹配通知"}],notifyTypes:[{value:2,label:"邮件"},{value:4,label:"WebHook"}],hosts:[],mailUsers:[],selectedHosts:[],selectedMailNotifyIds:[]}},computed:{commandPlaceholder:function(){return 1===this.form.protocol?"请输入URL地址":"请输入shell命令"}},watch:{"form.protocol":function(t){1===t&&(this.selectedHosts=[],this.form.host_id="")}},components:{taskSidebar:T},created:function(){var t=this,e=this.$route.params.id;S(e,function(a,s){if(e&&!a)return t.$message.error("数据不存在"),void t.cancel();if(t.hosts=(s||[]).filter(function(t){return t&&t.id}),a){t.form.id=a.id,t.form.name=a.name,t.form.tag=a.tag,t.form.level=a.level,a.dependency_status&&(t.form.dependency_status=a.dependency_status),t.form.dependency_task_id=a.dependency_task_id,t.form.spec=a.spec,t.form.protocol=a.protocol,a.http_method&&(t.form.http_method=a.http_method),t.form.command=a.command,t.form.timeout=a.timeout,t.form.multi=a.multi?1:2,t.form.notify_keyword=a.notify_keyword,void 0!==a.notify_status&&(t.form.notify_status=a.notify_status+1),t.form.notify_receiver_id=a.notify_receiver_id||"",void 0!==a.notify_type&&null!==a.notify_type&&(t.form.notify_type=a.notify_type+1),t.form.retry_times=a.retry_times,t.form.retry_interval=a.retry_interval,t.form.remark=a.remark;var i=[];2===t.form.protocol&&a.hosts&&a.hosts.forEach(function(t){t&&t.host_id&&i.push(t.host_id)}),t.selectedHosts=i;var r=[];if(t.form.notify_status>1&&t.form.notify_receiver_id){var o=t.form.notify_receiver_id.split(",");2===t.form.notify_type&&o.forEach(function(t){var e=parseInt(t);isNaN(e)||r.push(e)})}t.selectedMailNotifyIds=r}}),j(function(e){t.mailUsers=(e&&e.mail_users||[]).filter(function(t){return t&&t.id})})},methods:{copyCronExpr:function(t){var e=this,a=(t||"").trim();if(a){var s=function(){e.$message.success("复制成功")},i=function(){e.$message.error("复制失败，请手动复制")};if(navigator.clipboard&&navigator.clipboard.writeText)navigator.clipboard.writeText(a).then(s).catch(function(){try{var t=document.createElement("textarea");t.value=a,t.setAttribute("readonly","readonly"),t.style.position="fixed",t.style.top="-9999px",document.body.appendChild(t),t.select();var e=document.execCommand("copy");document.body.removeChild(t),e?s():i()}catch(t){i()}});else try{var r=document.createElement("textarea");r.value=a,r.setAttribute("readonly","readonly"),r.style.position="fixed",r.style.top="-9999px",document.body.appendChild(r),r.select();var o=document.execCommand("copy");document.body.removeChild(r),o?s():i()}catch(t){i()}}else this.$message.warning("可复制内容为空")},submit:function(){var t=this;this.$refs.form.validate(function(e){return!!e&&(2===t.form.protocol&&0===t.selectedHosts.length?(t.$message.error("请选择定时节点"),!1):t.form.notify_status>1&&2===t.form.notify_type&&0===t.selectedMailNotifyIds.length?(t.$message.error("请选择邮件接收用户"),!1):void t.save())})},save:function(){2===this.form.protocol&&this.selectedHosts.length>0?this.form.host_id=this.selectedHosts.filter(function(t){return t}).join(","):this.form.host_id="",this.form.notify_status>1&&2===this.form.notify_type&&(this.form.notify_receiver_id=this.selectedMailNotifyIds.filter(function(t){return t}).join(",")),F(this.form,function(){window.close()})},cancel:function(){window.close()},showCronSpecModal:function(){this.cronSpecActiveTab="basic",this.cronSpecModalVisible=!0},showNextRunsModal:function(){var t=(this.form.spec||"").trim();if(t){this.nextRunsList=[],this.nextRunsError="",this.nextRunsIsEveryType=!1,this.nextRunsModalVisible=!0;try{var e=t.match(/^@every\s+(.+)$/i);if(e){this.nextRunsIsEveryType=!0;var a=function(t){var e=0,a=t.match(/(\d+)h/);a&&(e+=36e5*parseInt(a[1],10));var s=t.match(/(\d+)m/);s&&(e+=6e4*parseInt(s[1],10));var i=t.match(/(\d+)s/);return i&&(e+=1e3*parseInt(i[1],10)),e}(e[1]);if(a<=0)return void(this.nextRunsError="无效的间隔时长");for(var s=Date.now(),i=1;i<=10;i++){var r=new Date(s+a*i);this.nextRunsList.push(G(r))}return}var o=function(t){var e=t.trim().split(/\s+/);return 5===e.length?e.join(" ")+" *":t}(t),n=A.a.parseExpression(o,{currentDate:new Date}).iterate(10);this.nextRunsList=n.map(function(t){return G(t)})}catch(t){this.nextRunsError=t&&t.message?t.message:"cron 表达式解析失败"}}else this.$message.warning("请先输入 cron 表达式")}}},K={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-container",[a("task-sidebar"),t._v(" "),a("el-main",[a("div",{staticClass:"page-header"},[a("h2",{staticClass:"page-title"},[t._v(t._s(t.form.id?"编辑定时":"新增定时"))])]),t._v(" "),a("el-form",{ref:"form",staticClass:"ios-form compact-form",attrs:{model:t.form,rules:t.formRules,"label-position":"top"}},[a("div",{staticClass:"form-section"},[a("div",{staticClass:"section-header"},[a("i",{staticClass:"el-icon-info"}),t._v(" "),a("span",[t._v("基础信息")])]),t._v(" "),a("div",{staticClass:"section-content"},[a("el-row",{attrs:{gutter:10}},[a("el-col",{attrs:{span:6}},[a("el-form-item",{attrs:{label:"定时名称",prop:"name"}},[a("el-input",{attrs:{placeholder:"定时名称"},model:{value:t.form.name,callback:function(e){t.$set(t.form,"name","string"==typeof e?e.trim():e)},expression:"form.name"}})],1)],1),t._v(" "),a("el-col",{attrs:{span:6}},[a("el-form-item",{staticClass:"label-with-tooltip"},[a("template",{slot:"label"},[a("span",[t._v("定时类型\n                      "),a("el-tooltip",{attrs:{content:"主定时可以配置多个子定时，当主定时执行完成后，自动执行子定时。定时类型新增后不能变更。",placement:"top"}},[a("i",{staticClass:"el-icon-question label-tooltip-icon"})])],1)]),t._v(" "),a("el-select",{staticStyle:{width:"100%"},attrs:{disabled:""!==t.form.id},model:{value:t.form.level,callback:function(e){t.$set(t.form,"level",e)},expression:"form.level"}},t._l(t.levelList,function(t){return a("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})}))],2)],1),t._v(" "),1===t.form.level?a("el-col",{attrs:{span:6}},[a("el-form-item",{staticClass:"cron-spec-form-item",attrs:{prop:"spec"}},[a("template",{slot:"label"},[a("span",{staticClass:"cron-label-wrap"},[a("span",[t._v("Cron 表达式")]),t._v(" "),a("el-tooltip",{attrs:{content:"点击查看 Cron 表达式说明和示例",placement:"top"}},[a("i",{staticClass:"el-icon-question label-tooltip-icon cron-spec-tooltip-icon",on:{click:function(e){return e.stopPropagation(),t.showCronSpecModal(e)}}})])],1)]),t._v(" "),a("el-input",{attrs:{placeholder:"秒 分 时 日 周 月"},model:{value:t.form.spec,callback:function(e){t.$set(t.form,"spec","string"==typeof e?e.trim():e)},expression:"form.spec"}},[a("span",{staticClass:"cron-next-runs-link",attrs:{slot:"suffix"},on:{click:function(e){return e.stopPropagation(),t.showNextRunsModal(e)}},slot:"suffix"},[t._v("未来执行时间")])])],2)],1):t._e(),t._v(" "),a("el-col",{attrs:{span:1===t.form.level?6:12}},[a("el-form-item",{attrs:{label:"标签"}},[a("el-input",{attrs:{placeholder:"标签"},model:{value:t.form.tag,callback:function(e){t.$set(t.form,"tag","string"==typeof e?e.trim():e)},expression:"form.tag"}})],1)],1)],1)],1)]),t._v(" "),a("div",{staticClass:"form-section"},[a("div",{staticClass:"section-header"},[a("i",{staticClass:"el-icon-copy-document"}),t._v(" "),a("span",[t._v("执行策略")])]),t._v(" "),a("div",{staticClass:"section-content"},[a("el-row",{attrs:{gutter:10}},[a("el-col",{attrs:{span:6}},[a("el-form-item",{attrs:{label:"执行方式"}},[a("el-select",{staticStyle:{width:"100%"},model:{value:t.form.protocol,callback:function(e){t.$set(t.form,"protocol",e)},expression:"form.protocol"}},t._l(t.protocolList,function(t){return a("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})}))],1)],1),t._v(" "),2===t.form.protocol?a("el-col",{attrs:{span:6}},[a("el-form-item",{attrs:{label:"定时节点 (必选)"}},[a("el-select",{key:"host-select-"+t.form.protocol,staticStyle:{width:"100%"},attrs:{filterable:"",multiple:"",placeholder:"请选择执行节点"},model:{value:t.selectedHosts,callback:function(e){t.selectedHosts=e},expression:"selectedHosts"}},t._l(t.hosts,function(t){return a("el-option",{key:t.id,attrs:{label:t.alias+" - "+t.name,value:t.id}})}))],1)],1):t._e(),t._v(" "),1===t.form.protocol?a("el-col",{attrs:{span:6}},[a("el-form-item",{attrs:{label:"请求方法"}},[a("el-select",{staticStyle:{width:"100%"},model:{value:t.form.http_method,callback:function(e){t.$set(t.form,"http_method",e)},expression:"form.http_method"}},t._l(t.httpMethods,function(t){return a("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})}))],1)],1):t._e(),t._v(" "),1===t.form.level?a("el-col",{attrs:{span:6}},[a("el-form-item",{staticClass:"label-with-tooltip"},[a("template",{slot:"label"},[a("span",[t._v("依赖关系\n                      "),a("el-tooltip",{attrs:{content:t.dependencyTooltipContent,placement:"top","popper-class":"label-tooltip-popper"}},[a("i",{staticClass:"el-icon-question label-tooltip-icon"})])],1)]),t._v(" "),a("el-select",{staticStyle:{width:"100%"},model:{value:t.form.dependency_status,callback:function(e){t.$set(t.form,"dependency_status",e)},expression:"form.dependency_status"}},t._l(t.dependencyStatusList,function(t){return a("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})}))],2)],1):t._e(),t._v(" "),1===t.form.level?a("el-col",{attrs:{span:6}},[a("el-form-item",{attrs:{label:"子定时 ID"}},[a("el-input",{attrs:{placeholder:"多个 ID 请使用逗号分隔"},model:{value:t.form.dependency_task_id,callback:function(e){t.$set(t.form,"dependency_task_id","string"==typeof e?e.trim():e)},expression:"form.dependency_task_id"}})],1)],1):t._e()],1),t._v(" "),a("el-form-item",{attrs:{label:"执行命令",prop:"command"}},[a("el-input",{staticClass:"code-editor",attrs:{type:"textarea",rows:4,placeholder:t.commandPlaceholder},model:{value:t.form.command,callback:function(e){t.$set(t.form,"command",e)},expression:"form.command"}})],1)],1)]),t._v(" "),a("div",{staticClass:"form-section"},[a("div",{staticClass:"section-header"},[a("i",{staticClass:"el-icon-timer"}),t._v(" "),a("span",[t._v("超时设置")])]),t._v(" "),a("div",{staticClass:"section-content"},[a("el-row",{attrs:{gutter:10}},[a("el-col",{attrs:{span:6}},[a("el-form-item",{attrs:{label:"超时限制 (秒)",prop:"timeout"}},[a("el-input-number",{staticStyle:{width:"100%"},attrs:{min:0,max:86400},model:{value:t.form.timeout,callback:function(e){t.$set(t.form,"timeout",t._n(e))},expression:"form.timeout"}})],1)],1),t._v(" "),a("el-col",{attrs:{span:6}},[a("el-form-item",{staticClass:"label-with-tooltip"},[a("template",{slot:"label"},[a("span",[t._v("单实例运行\n                      "),a("el-tooltip",{attrs:{content:"单实例运行, 前次定时未执行完成，下次定时调度时间到了是否要执行, 即是否允许多进程执行同一定时\n",placement:"top"}},[a("i",{staticClass:"el-icon-question label-tooltip-icon"})])],1)]),t._v(" "),a("el-select",{staticStyle:{width:"100%"},model:{value:t.form.multi,callback:function(e){t.$set(t.form,"multi",e)},expression:"form.multi"}},t._l(t.runStatusList,function(t){return a("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})}))],2)],1),t._v(" "),a("el-col",{attrs:{span:6}},[a("el-form-item",{attrs:{label:"失败重试次数",prop:"retry_times"}},[a("el-input-number",{staticStyle:{width:"100%"},attrs:{min:0,max:10},model:{value:t.form.retry_times,callback:function(e){t.$set(t.form,"retry_times",t._n(e))},expression:"form.retry_times"}})],1)],1),t._v(" "),a("el-col",{attrs:{span:6}},[a("el-form-item",{attrs:{label:"重试间隔 (秒)",prop:"retry_interval"}},[a("el-input-number",{staticStyle:{width:"100%"},attrs:{min:0,max:3600},model:{value:t.form.retry_interval,callback:function(e){t.$set(t.form,"retry_interval",t._n(e))},expression:"form.retry_interval"}})],1)],1)],1)],1)]),t._v(" "),a("div",{staticClass:"form-section"},[a("div",{staticClass:"section-header"},[a("i",{staticClass:"el-icon-more"}),t._v(" "),a("span",[t._v("其他")])]),t._v(" "),a("div",{staticClass:"section-content"},[a("el-row",{attrs:{gutter:10}},[a("el-col",{attrs:{span:6}},[a("el-form-item",{attrs:{label:"通知策略"}},[a("el-select",{staticStyle:{width:"100%"},model:{value:t.form.notify_status,callback:function(e){t.$set(t.form,"notify_status",e)},expression:"form.notify_status"}},t._l(t.notifyStatusList,function(t){return a("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})}))],1)],1),t._v(" "),1!==t.form.notify_status?a("el-col",{attrs:{span:6}},[a("el-form-item",{attrs:{label:"通知渠道"}},[a("el-select",{staticStyle:{width:"100%"},model:{value:t.form.notify_type,callback:function(e){t.$set(t.form,"notify_type",e)},expression:"form.notify_type"}},t._l(t.notifyTypes,function(t){return a("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})}))],1)],1):t._e(),t._v(" "),1!==t.form.notify_status&&2===t.form.notify_type?a("el-col",{attrs:{span:6}},[a("el-form-item",{attrs:{label:"接收用户"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{filterable:"",multiple:"",placeholder:"选择邮件接收者"},model:{value:t.selectedMailNotifyIds,callback:function(e){t.selectedMailNotifyIds=e},expression:"selectedMailNotifyIds"}},t._l(t.mailUsers,function(t){return a("el-option",{key:t.id,attrs:{label:t.username,value:t.id}})}))],1)],1):t._e(),t._v(" "),1!==t.form.notify_status&&4===t.form.notify_type?a("el-col",{attrs:{span:6}},[a("el-form-item",{attrs:{label:"WebHook URL"}},[a("el-input",{attrs:{placeholder:"请输入 WebHook URL 地址"},model:{value:t.form.notify_receiver_id,callback:function(e){t.$set(t.form,"notify_receiver_id","string"==typeof e?e.trim():e)},expression:"form.notify_receiver_id"}})],1)],1):t._e(),t._v(" "),4===t.form.notify_status?a("el-col",{attrs:{span:6}},[a("el-form-item",{attrs:{label:"匹配关键字",prop:"notify_keyword"}},[a("el-input",{attrs:{placeholder:"定时输出中包含此关键字时触发通知"},model:{value:t.form.notify_keyword,callback:function(e){t.$set(t.form,"notify_keyword","string"==typeof e?e.trim():e)},expression:"form.notify_keyword"}})],1)],1):t._e()],1),t._v(" "),a("el-form-item",{attrs:{label:"备注说明"}},[a("el-input",{attrs:{type:"textarea",rows:2,placeholder:"备注信息"},model:{value:t.form.remark,callback:function(e){t.$set(t.form,"remark",e)},expression:"form.remark"}})],1)],1)]),t._v(" "),a("div",{staticClass:"form-actions"},[a("el-button",{on:{click:t.cancel}},[t._v("取消")]),t._v(" "),a("el-button",{attrs:{type:"primary",loading:""===t.form.id&&!1},on:{click:t.submit}},[t._v("保存")])],1)]),t._v(" "),a("el-dialog",{attrs:{visible:t.cronSpecModalVisible,width:"720px","custom-class":"cron-spec-dialog-wrap","show-close":!0},on:{"update:visible":function(e){t.cronSpecModalVisible=e}}},[a("div",{staticClass:"cron-spec-header",attrs:{slot:"title"},slot:"title"},[a("span",{staticClass:"cron-spec-header-title"},[t._v("Cron 表达式说明")])]),t._v(" "),a("el-tabs",{staticClass:"cron-spec-tabs",model:{value:t.cronSpecActiveTab,callback:function(e){t.cronSpecActiveTab=e},expression:"cronSpecActiveTab"}},[a("el-tab-pane",{attrs:{label:"特殊字符与预定义",name:"basic"}},[a("div",{staticClass:"cron-spec-content"},[a("h4",[t._v("特殊字符")]),t._v(" "),a("ul",[a("li",[a("strong",[t._v("*")]),t._v(" 所有有效值")]),t._v(" "),a("li",[a("strong",[t._v("/")]),t._v(" 步长，如 */5、3-59/15")]),t._v(" "),a("li",[a("strong",[t._v(",")]),t._v(" 多个值，如 1,3,5")]),t._v(" "),a("li",[a("strong",[t._v("-")]),t._v(" 范围，如 9-17")]),t._v(" "),a("li",[a("strong",[t._v("?")]),t._v(" 日或周中允许为空（二选一）")])]),t._v(" "),a("h4",[t._v("预定义表达式")]),t._v(" "),a("table",{staticClass:"cron-spec-table"},[a("tr",[a("th",[t._v("表达式")]),t._v(" "),a("th",[t._v("含义")])]),t._v(" "),a("tr",[a("td",[t._v("@yearly / @annually")]),t._v(" "),a("td",[t._v("每年 1 月 1 日 0:00")])]),t._v(" "),a("tr",[a("td",[t._v("@monthly")]),t._v(" "),a("td",[t._v("每月 1 日 0:00")])]),t._v(" "),a("tr",[a("td",[t._v("@weekly")]),t._v(" "),a("td",[t._v("每周日 0:00")])]),t._v(" "),a("tr",[a("td",[t._v("@daily / @midnight")]),t._v(" "),a("td",[t._v("每天 0:00")])]),t._v(" "),a("tr",[a("td",[t._v("@hourly")]),t._v(" "),a("td",[t._v("每小时整点")])])]),t._v(" "),a("h4",[t._v("固定间隔")]),t._v(" "),a("p",[t._v("格式："),a("code",[t._v("@every <duration>")])]),t._v(" "),a("p",[t._v("示例："),a("code",[t._v("@every 1h")]),t._v("、"),a("code",[t._v("@every 30m")]),t._v("、"),a("code",[t._v("@every 1h30m10s")])])])]),t._v(" "),a("el-tab-pane",{attrs:{label:"常用示例",name:"examples"}},[a("div",{staticClass:"cron-spec-content"},[a("h4",[t._v("时间表达式常用示例")]),t._v(" "),a("table",{staticClass:"cron-spec-table"},[a("tr",[a("th",[t._v("示例")]),t._v(" "),a("th",[t._v("Cron 表达式")])]),t._v(" "),a("tr",[a("td",[t._v("每天 12:00 调度")]),t._v(" "),a("td",[a("span",{staticClass:"cron-spec-copy-wrap"},[a("code",[t._v("0 0 12 * * *")]),t._v(" "),a("button",{staticClass:"cron-spec-copy-btn",attrs:{type:"button"},on:{click:function(e){e.stopPropagation(),t.copyCronExpr("0 0 12 * * *")}}},[t._v("复制")])])])]),t._v(" "),a("tr",[a("td",[t._v("每天 12:30 调度")]),t._v(" "),a("td",[a("span",{staticClass:"cron-spec-copy-wrap"},[a("code",[t._v("0 30 12 * * *")]),t._v(" "),a("button",{staticClass:"cron-spec-copy-btn",attrs:{type:"button"},on:{click:function(e){e.stopPropagation(),t.copyCronExpr("0 30 12 * * *")}}},[t._v("复制")])])])]),t._v(" "),a("tr",[a("td",[t._v("每小时的 26、29、33 分调度")]),t._v(" "),a("td",[a("span",{staticClass:"cron-spec-copy-wrap"},[a("code",[t._v("0 26,29,33 * * *")]),t._v(" "),a("button",{staticClass:"cron-spec-copy-btn",attrs:{type:"button"},on:{click:function(e){e.stopPropagation(),t.copyCronExpr("0 26,29,33 * * *")}}},[t._v("复制")])])])]),t._v(" "),a("tr",[a("td",[t._v("周一到周五每天 12:30 调度")]),t._v(" "),a("td",[a("span",{staticClass:"cron-spec-copy-wrap"},[a("code",[t._v("0 30 12 ? * MON-FRI")]),t._v(" "),a("button",{staticClass:"cron-spec-copy-btn",attrs:{type:"button"},on:{click:function(e){e.stopPropagation(),t.copyCronExpr("0 30 12 ? * MON-FRI")}}},[t._v("复制")])])])]),t._v(" "),a("tr",[a("td",[t._v("周一到周五每天 12:00～14:00 每 5 分钟调度")]),t._v(" "),a("td",[a("span",{staticClass:"cron-spec-copy-wrap"},[a("code",[t._v("0 0/5 12-13 ? * MON-FRI")]),t._v(" "),a("button",{staticClass:"cron-spec-copy-btn",attrs:{type:"button"},on:{click:function(e){e.stopPropagation(),t.copyCronExpr("0 0/5 12-13 ? * MON-FRI")}}},[t._v("复制")])])])]),t._v(" "),a("tr",[a("td",[t._v("一月到四月每天 12:00 调度")]),t._v(" "),a("td",[a("span",{staticClass:"cron-spec-copy-wrap"},[a("code",[t._v("0 0 12 * 1-4 ?")]),t._v(" "),a("button",{staticClass:"cron-spec-copy-btn",attrs:{type:"button"},on:{click:function(e){e.stopPropagation(),t.copyCronExpr("0 0 12 * 1-4 ?")}}},[t._v("复制")])])])])])])]),t._v(" "),a("el-tab-pane",{attrs:{label:"字段说明",name:"fields"}},[a("div",{staticClass:"cron-spec-content"},[a("h4",[t._v("标准 6 字段格式")]),t._v(" "),a("table",{staticClass:"cron-spec-table"},[a("tr",[a("th",[t._v("字段")]),t._v(" "),a("th",[t._v("必填")]),t._v(" "),a("th",[t._v("取值范围")]),t._v(" "),a("th",[t._v("特殊字符")])]),t._v(" "),a("tr",[a("td",[t._v("秒")]),t._v(" "),a("td",[t._v("是")]),t._v(" "),a("td",[t._v("0～59")]),t._v(" "),a("td",[t._v("不允许设置特殊字符")])]),t._v(" "),a("tr",[a("td",[t._v("分")]),t._v(" "),a("td",[t._v("是")]),t._v(" "),a("td",[t._v("0～59")]),t._v(" "),a("td",[t._v(", - * /")])]),t._v(" "),a("tr",[a("td",[t._v("小时")]),t._v(" "),a("td",[t._v("是")]),t._v(" "),a("td",[t._v("0～23")]),t._v(" "),a("td",[t._v(", - * /")])]),t._v(" "),a("tr",[a("td",[t._v("日期")]),t._v(" "),a("td",[t._v("是")]),t._v(" "),a("td",[t._v("1～31")]),t._v(" "),a("td",[t._v(", - * ? /")])]),t._v(" "),a("tr",[a("td",[t._v("月份")]),t._v(" "),a("td",[t._v("是")]),t._v(" "),a("td",[t._v("1～12 或 JAN～DEC")]),t._v(" "),a("td",[t._v(", - * /")])]),t._v(" "),a("tr",[a("td",[t._v("星期")]),t._v(" "),a("td",[t._v("是")]),t._v(" "),a("td",[t._v("0～6 或 MON～SUN")]),t._v(" "),a("td",[t._v(", - * ?")])])])])])],1)],1),t._v(" "),a("el-dialog",{staticClass:"next-runs-dialog",attrs:{visible:t.nextRunsModalVisible,width:"480px","show-close":!0,"custom-class":"next-runs-dialog-wrap"},on:{"update:visible":function(e){t.nextRunsModalVisible=e}}},[a("div",{staticClass:"next-runs-header",attrs:{slot:"title"},slot:"title"},[a("span",{staticClass:"next-runs-header-title"},[t._v("未来执行时间")]),t._v(" "),a("span",{staticClass:"next-runs-header-subtitle"},[t._v("未来十次执行时间为")])]),t._v(" "),a("div",{staticClass:"next-runs-content"},[t.nextRunsIsEveryType&&t.nextRunsList.length?a("p",{staticClass:"next-runs-every-tip"},[t._v("根据当前时间计算，可能与实际略有差异。")]):t._e(),t._v(" "),t.nextRunsList.length?a("div",{staticClass:"next-runs-list-wrap"},t._l(t.nextRunsList,function(e,s){return a("div",{key:s,staticClass:"next-runs-item"},[a("span",{staticClass:"next-runs-item-index"},[t._v(t._s(s+1))]),t._v(" "),a("span",{staticClass:"next-runs-item-time"},[t._v(t._s(e))])])})):a("div",{staticClass:"next-runs-empty"},[a("span",{staticClass:"next-runs-empty-text"},[t._v(t._s(t.nextRunsError||"暂无数据"))])])])])],1)],1)},staticRenderFns:[]};var Q=a("VU/8")(Z,K,!1,function(t){a("sz0f"),a("BbYC")},"data-v-646bc113",null).exports,X={name:"task-log",data:function(){return{logs:[],logTotal:0,searchParams:{page_size:20,page:1,keyword:"",tag:"",protocol:"",status:""},isAdmin:this.$store.getters.user.isAdmin,dialogVisible:!1,logDetailDialogVisible:!1,loading:!1,searchTimer:null,tagLoading:!1,tagOptions:[],currentTaskResult:{command:"",result:""},currentLogDetail:null,protocolList:[{value:"1",label:"http"},{value:"2",label:"shell"}],statusList:[{value:"2",label:"执行"},{value:"3",label:"成功"},{value:"1",label:"失败"},{value:"4",label:"取消"}]}},components:{taskSidebar:T},created:function(){this.$route.query.task_id&&(this.searchParams.keyword=this.$route.query.task_id),this.loadTags(),this.search()},methods:{formatProtocol:function(t,e){return 1===t[e.property]?"http":"shell"},changePage:function(t){this.searchParams.page=t,this.search()},changePageSize:function(t){this.searchParams.page_size=t,this.searchParams.page=1,this.search()},search:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.searchTimer&&(clearTimeout(this.searchTimer),this.searchTimer=null),this.loading=!0,z(this.searchParams,function(a){t.logs=a.data,t.logTotal=a.total,t.loading=!1,e&&e()})},debouncedSearch:function(){var t=this;this.searchTimer&&clearTimeout(this.searchTimer),this.searchTimer=setTimeout(function(){t.searchParams.page=1,t.search()},500)},loadTags:function(){var t=this;this.tagLoading=!0,D({},function(e){t.tagOptions=Array.isArray(e)?e:[],t.tagLoading=!1},function(){t.tagLoading=!1})},clearLog:function(){var t=this;this.$appConfirm(function(){V(function(){t.searchParams.page=1,t.search()})})},stopTask:function(t){var e=this;E(t.id,t.task_id,function(){e.search()})},showTaskResult:function(t){this.dialogVisible=!0,this.currentTaskResult.command=t.command,this.currentTaskResult.result=t.result},showLogDetail:function(t){this.currentLogDetail=C()({},t),this.logDetailDialogVisible=!0},closeLogDetailDialog:function(){this.currentLogDetail=null},refresh:function(){var t=this;this.search(function(){t.$message.success("刷新成功")})}}},tt={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-container",[a("task-sidebar"),t._v(" "),a("el-main",{staticClass:"ios-tasklog-page"},[a("div",{staticClass:"action-bar"},[a("el-form",{staticClass:"search-form",attrs:{inline:!0},nativeOn:{submit:function(t){t.preventDefault()}}},[a("el-form-item",[a("el-input",{staticClass:"search-input-small",attrs:{placeholder:"定时ID/定时名称",clearable:""},on:{input:t.debouncedSearch,clear:function(e){t.search(null)}},model:{value:t.searchParams.keyword,callback:function(e){t.$set(t.searchParams,"keyword","string"==typeof e?e.trim():e)},expression:"searchParams.keyword"}})],1),t._v(" "),a("el-form-item",[a("el-select",{staticClass:"search-select",attrs:{placeholder:"标签",filterable:"",clearable:""},on:{change:function(e){t.search(null)}},model:{value:t.searchParams.tag,callback:function(e){t.$set(t.searchParams,"tag","string"==typeof e?e.trim():e)},expression:"searchParams.tag"}},t._l(t.tagOptions,function(t){return a("el-option",{key:t,attrs:{label:t,value:t}})}))],1),t._v(" "),a("el-form-item",[a("el-select",{staticClass:"search-select",attrs:{placeholder:"全部执行方式",clearable:""},on:{change:function(e){t.search(null)}},model:{value:t.searchParams.protocol,callback:function(e){t.$set(t.searchParams,"protocol","string"==typeof e?e.trim():e)},expression:"searchParams.protocol"}},[a("el-option",{attrs:{label:"全部执行方式",value:""}}),t._v(" "),t._l(t.protocolList,function(t){return a("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})],2)],1),t._v(" "),a("el-form-item",[a("el-select",{staticClass:"search-select",attrs:{placeholder:"全部状态",clearable:""},on:{change:function(e){t.search(null)}},model:{value:t.searchParams.status,callback:function(e){t.$set(t.searchParams,"status","string"==typeof e?e.trim():e)},expression:"searchParams.status"}},[a("el-option",{attrs:{label:"全部状态",value:""}}),t._v(" "),t._l(t.statusList,function(t){return a("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})],2)],1)],1),t._v(" "),a("div",{staticClass:"action-buttons"},[a("el-button",{staticClass:"ios-action-btn",attrs:{type:"info",plain:""},on:{click:t.refresh}},[a("i",{staticClass:"el-icon-refresh",class:{"is-loading":t.loading}}),t._v("\n            刷新\n          ")]),t._v(" "),t.isAdmin?a("el-button",{staticClass:"ios-action-btn",attrs:{type:"danger",plain:"",icon:"el-icon-delete"},on:{click:t.clearLog}},[t._v("清空日志")]):t._e()],1)],1),t._v(" "),a("div",{staticClass:"pagination-bar top"},[a("span",{staticClass:"pagination-total"},[t._v("共 "+t._s(t.logTotal)+" 条")]),t._v(" "),a("el-pagination",{staticClass:"ios-pagination",attrs:{background:"",layout:"prev, pager, next, jumper, sizes",total:t.logTotal,"page-sizes":[10,20,50,100],"page-size":t.searchParams.page_size,"current-page":t.searchParams.page},on:{"size-change":t.changePageSize,"current-change":t.changePage}})],1),t._v(" "),a("div",{staticClass:"ios-table-card"},[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],ref:"table",staticClass:"dark-table ios-data-table",staticStyle:{width:"100%"},attrs:{data:t.logs}},[a("el-table-column",{attrs:{prop:"id",label:"日志ID",width:"100"}}),t._v(" "),a("el-table-column",{attrs:{label:"定时名称","min-width":"220"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",{staticClass:"task-name-cell"},[a("span",[t._v(t._s(e.row.name))]),t._v(" "),a("el-tooltip",{attrs:{content:"定时ID",placement:"top"}},[a("span",{staticClass:"task-id-sub"},[t._v(t._s(e.row.task_id))])])],1)]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"protocol",label:"执行方式",width:"100",formatter:t.formatProtocol}}),t._v(" "),a("el-table-column",{attrs:{label:"标签","min-width":"120"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",{staticClass:"ios-tag"},[t._v(t._s(e.row.tag||"-"))])]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"执行时间",width:"300"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",{staticClass:"time-info"},[a("span",[t._v(t._s(t._f("formatTime")(e.row.start_time)))]),t._v(" "),1!==e.row.status?a("span",[t._v("~ "+t._s(t._f("formatTime")(e.row.end_time)))]):t._e(),t._v(" "),a("div",{staticClass:"duration"},[t._v("耗时: "+t._s(e.row.total_time>0?e.row.total_time:1)+"s")])])]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"状态",width:"100"},scopedSlots:t._u([{key:"default",fn:function(e){return[0===e.row.status?a("el-tag",{attrs:{type:"danger",effect:"dark"}},[t._v("失败")]):1===e.row.status?a("el-tag",{attrs:{type:"primary",effect:"dark"}},[t._v("执行")]):2===e.row.status?a("el-tag",{attrs:{type:"success",effect:"dark"}},[t._v("成功")]):3===e.row.status?a("el-tag",{attrs:{type:"info",effect:"dark"}},[t._v("取消")]):t._e()]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"操作",align:"center",width:"140"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",{staticClass:"action-buttons",staticStyle:{"justify-content":"center"}},[a("el-button",{attrs:{size:"mini",type:"info",plain:""},on:{click:function(a){t.showLogDetail(e.row)}}},[t._v("详情")]),t._v(" "),2===e.row.status||0===e.row.status?a("el-button",{attrs:{size:"mini",type:"primary",plain:""},on:{click:function(a){t.showTaskResult(e.row)}}},[t._v("结果")]):t._e(),t._v(" "),1===e.row.status&&2===e.row.protocol?a("el-button",{attrs:{size:"mini",type:"danger",plain:""},on:{click:function(a){t.stopTask(e.row)}}},[t._v("停止")]):t._e()],1)]}}])})],1)],1),t._v(" "),a("div",{staticClass:"pagination-bar pagination-bar-bottom"},[a("span",{staticClass:"pagination-total"},[t._v("共 "+t._s(t.logTotal)+" 条")]),t._v(" "),a("el-pagination",{staticClass:"ios-pagination",attrs:{background:"",layout:"prev, pager, next, jumper, sizes",total:t.logTotal,"page-sizes":[10,20,50,100],"page-size":t.searchParams.page_size,"current-page":t.searchParams.page},on:{"size-change":t.changePageSize,"current-change":t.changePage}})],1),t._v(" "),a("el-dialog",{attrs:{title:"任务执行详情",visible:t.dialogVisible,width:"800px","custom-class":"result-dialog","append-to-body":!0},on:{"update:visible":function(e){t.dialogVisible=e}}},[a("div",{staticClass:"result-content"},[a("div",{staticClass:"result-section"},[a("div",{staticClass:"section-label"},[t._v("执行命令")]),t._v(" "),a("div",{staticClass:"code-container command"},[a("code",[t._v(t._s(t.currentTaskResult.command))])])]),t._v(" "),a("div",{staticClass:"result-section"},[a("div",{staticClass:"section-label"},[t._v("输出结果")]),t._v(" "),a("div",{staticClass:"code-container output"},[a("pre",[t._v(t._s(t.currentTaskResult.result||"无输出结果"))])])])])]),t._v(" "),a("el-dialog",{attrs:{title:"日志详情",visible:t.logDetailDialogVisible,width:"760px","custom-class":"task-detail-dialog","append-to-body":!0},on:{"update:visible":function(e){t.logDetailDialogVisible=e},close:t.closeLogDetailDialog}},[t.currentLogDetail?a("div",{staticClass:"task-expand-wrap"},[a("div",{staticClass:"task-expand-section task-expand-grid"},[a("div",{staticClass:"task-expand-row"},[a("span",{staticClass:"task-expand-label"},[t._v("日志ID")]),t._v(" "),a("span",{staticClass:"task-expand-value"},[t._v(t._s(t.currentLogDetail.id))])]),t._v(" "),a("div",{staticClass:"task-expand-row"},[a("span",{staticClass:"task-expand-label"},[t._v("定时ID")]),t._v(" "),a("span",{staticClass:"task-expand-value"},[t._v(t._s(t.currentLogDetail.task_id))])]),t._v(" "),a("div",{staticClass:"task-expand-row"},[a("span",{staticClass:"task-expand-label"},[t._v("重试次数")]),t._v(" "),a("span",{staticClass:"task-expand-value"},[t._v(t._s(t.currentLogDetail.retry_times))])])]),t._v(" "),a("div",{staticClass:"task-expand-section"},[a("div",{staticClass:"task-expand-row task-expand-row-full"},[a("span",{staticClass:"task-expand-label"},[t._v("Cron表达式")]),t._v(" "),a("span",{staticClass:"task-expand-value task-expand-value-code"},[t._v(t._s(t.currentLogDetail.spec||"-"))])])]),t._v(" "),a("div",{staticClass:"task-expand-section"},[a("div",{staticClass:"task-expand-row task-expand-row-full"},[a("span",{staticClass:"task-expand-label"},[t._v("执行命令")]),t._v(" "),a("span",{staticClass:"task-expand-value task-expand-value-code"},[t._v(t._s(t.currentLogDetail.command||"-"))])])])]):t._e()])],1)],1)},staticRenderFns:[]},et=a("VU/8")(X,tt,!1,null,null,null).exports,at=function(t,e,a){ne.get("/host",t,e,a)},st=function(t,e){ne.post("/host/store",t,e)},it=function(t,e){ne.post("/host/remove/"+t,{},e)},rt=function(t,e){ne.get("/host/ping/"+t,{},e)},ot={name:"host-list",components:{taskSidebar:T},data:function(){return{hosts:[],hostTotal:0,loading:!1,searchParams:{page_size:20,page:1,name:"",alias:""},isAdmin:this.$store.getters.user.isAdmin,hostModalVisible:!1,hostLoading:!1,hostForm:{id:"",alias:"",name:"",port:5921,remark:""},hostRules:{alias:[{required:!0,message:"请输入节点名称",trigger:"blur"}],name:[{required:!0,message:"请输入主机名/IP",trigger:"blur"}],port:[{required:!0,message:"请输入端口",trigger:"blur"}]}}},created:function(){this.search()},beforeDestroy:function(){this._searchTimer&&clearTimeout(this._searchTimer)},methods:{debouncedSearch:function(){var t=this;this._searchTimer&&clearTimeout(this._searchTimer),this._searchTimer=setTimeout(function(){t.searchParams.page=1,t.search()},400)},changePage:function(t){this.searchParams.page=t,this.search()},changePageSize:function(t){this.searchParams.page_size=t,this.searchParams.page=1,this.search()},search:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.loading=!0,at(this.searchParams,function(a){t.hosts=a.data,t.hostTotal=a.total,t.loading=!1,"function"==typeof e&&e()},function(){t.loading=!1})},remove:function(t){var e=this;this.$appConfirm(function(){it(t.id,function(){return e.refresh()})})},ping:function(t){var e=this;rt(t.id,function(){e.$message.success("连接成功")})},toTasks:function(t){this.$router.push({path:"/task",query:{host_id:t.id}})},refresh:function(){var t=this;this.search(function(){t.$message.success("刷新成功")})},openHostModal:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;t?(this.hostForm.id=t.id,this.hostForm.alias=t.alias,this.hostForm.name=t.name,this.hostForm.port=t.port,this.hostForm.remark=t.remark):this.hostForm.id="",this.hostModalVisible=!0},resetHostForm:function(){this.hostForm={id:"",alias:"",name:"",port:5921,remark:""},this.$refs.hostForm&&this.$refs.hostForm.resetFields()},submitHostForm:function(){var t=this;this.$refs.hostForm.validate(function(e){e&&(t.hostLoading=!0,st(t.hostForm,function(){t.hostLoading=!1,t.hostModalVisible=!1,t.$message.success("操作成功"),t.refresh()},function(){t.hostLoading=!1}))})}}},nt={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-container",[a("task-sidebar"),t._v(" "),a("el-main",{staticClass:"ios-host-page"},[a("div",{staticClass:"page-header"},[a("h2",{staticClass:"page-title"},[t._v("节点管理")])]),t._v(" "),a("div",{staticClass:"search-bar"},[a("div",{staticClass:"search-filters"},[a("el-input",{staticClass:"search-input",attrs:{placeholder:"节点名称",clearable:""},on:{input:t.debouncedSearch},nativeOn:{keyup:function(e){if(!("button"in e)&&t._k(e.keyCode,"enter",13,e.key,"Enter"))return null;t.search()}},model:{value:t.searchParams.alias,callback:function(e){t.$set(t.searchParams,"alias","string"==typeof e?e.trim():e)},expression:"searchParams.alias"}}),t._v(" "),a("el-input",{staticClass:"search-input",attrs:{placeholder:"主机IP",clearable:""},on:{input:t.debouncedSearch},nativeOn:{keyup:function(e){if(!("button"in e)&&t._k(e.keyCode,"enter",13,e.key,"Enter"))return null;t.search()}},model:{value:t.searchParams.name,callback:function(e){t.$set(t.searchParams,"name","string"==typeof e?e.trim():e)},expression:"searchParams.name"}})],1),t._v(" "),a("div",{staticClass:"search-actions"},[t.isAdmin?a("el-button",{staticClass:"ios-action-btn",attrs:{type:"primary",plain:""},on:{click:function(e){t.openHostModal()}}},[t._v("新增节点")]):t._e(),t._v(" "),a("el-button",{staticClass:"ios-action-btn",attrs:{type:"primary",plain:""},on:{click:t.refresh}},[t._v("刷新")])],1)]),t._v(" "),a("div",{staticClass:"ios-table-card"},[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"ios-data-table",staticStyle:{width:"100%"},attrs:{data:t.hosts}},[a("el-table-column",{attrs:{prop:"id",label:"节点ID",width:"90"}}),t._v(" "),a("el-table-column",{attrs:{prop:"alias",label:"节点名称"}}),t._v(" "),a("el-table-column",{attrs:{prop:"name",label:"主机IP"}}),t._v(" "),a("el-table-column",{attrs:{prop:"port",label:"端口",width:"80"}}),t._v(" "),a("el-table-column",{attrs:{label:"查看定时",width:"100"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{staticClass:"link-btn",attrs:{type:"text"},on:{click:function(a){t.toTasks(e.row)}}},[t._v("查看定时")])]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"remark",label:"备注","show-overflow-tooltip":""}}),t._v(" "),t.isAdmin?a("el-table-column",{attrs:{label:"操作",width:"260"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",{staticClass:"action-buttons"},[a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(a){t.openHostModal(e.row)}}},[t._v("编辑")]),t._v(" "),a("el-button",{attrs:{type:"info",size:"mini"},on:{click:function(a){t.ping(e.row)}}},[t._v("测试连接")]),t._v(" "),a("el-button",{attrs:{type:"danger",size:"mini"},on:{click:function(a){t.remove(e.row)}}},[t._v("删除")])],1)]}}])}):t._e()],1)],1),t._v(" "),a("div",{staticClass:"pagination-bar"},[a("span",{staticClass:"pagination-total"},[t._v("共 "+t._s(t.hostTotal)+" 条")]),t._v(" "),a("el-pagination",{staticClass:"ios-pagination",attrs:{background:"",layout:"prev, pager, next, jumper, sizes",total:t.hostTotal,"current-page":t.searchParams.page,"page-size":t.searchParams.page_size,"page-sizes":[10,20,50,100]},on:{"size-change":t.changePageSize,"current-change":t.changePage}})],1),t._v(" "),a("el-dialog",{attrs:{title:t.hostForm.id?"编辑节点":"新增节点",visible:t.hostModalVisible,width:"480px","close-on-click-modal":!1,"append-to-body":!0,"custom-class":"pwd-dialog"},on:{"update:visible":function(e){t.hostModalVisible=e},closed:t.resetHostForm}},[a("el-form",{ref:"hostForm",attrs:{model:t.hostForm,rules:t.hostRules,"label-width":"90px"}},[a("el-form-item",{attrs:{label:"节点名称",prop:"alias"}},[a("el-input",{attrs:{placeholder:"请输入节点展示名称"},model:{value:t.hostForm.alias,callback:function(e){t.$set(t.hostForm,"alias","string"==typeof e?e.trim():e)},expression:"hostForm.alias"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"主机IP",prop:"name"}},[a("el-input",{attrs:{placeholder:"请输入 IP 或主机名"},model:{value:t.hostForm.name,callback:function(e){t.$set(t.hostForm,"name","string"==typeof e?e.trim():e)},expression:"hostForm.name"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"端口",prop:"port"}},[a("el-input-number",{attrs:{min:1,max:65535,label:"端口"},model:{value:t.hostForm.port,callback:function(e){t.$set(t.hostForm,"port",e)},expression:"hostForm.port"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"备注",prop:"remark"}},[a("el-input",{attrs:{type:"textarea",placeholder:"节点备注信息"},model:{value:t.hostForm.remark,callback:function(e){t.$set(t.hostForm,"remark",e)},expression:"hostForm.remark"}})],1)],1),t._v(" "),a("span",{attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){t.hostModalVisible=!1}}},[t._v("取消")]),t._v(" "),a("el-button",{attrs:{type:"primary",loading:t.hostLoading},on:{click:t.submitHostForm}},[t._v("保存")])],1)],1)],1)],1)},staticRenderFns:[]};var lt=a("VU/8")(ot,nt,!1,function(t){a("R8Fp")},"data-v-55f09542",null).exports,ct=function(t,e,a){ne.get("/user",t||{},e,a)},ut=function(t,e){ne.get("/user/"+t,{},e)},dt=function(t,e){ne.post("/user/store",t,e)},pt=function(t,e,a,s){ne.post("/user/login",{username:t,password:e},a,s)},mt=function(t,e){ne.post("/user/enable/"+t,{},e)},vt=function(t,e){ne.post("/user/disable/"+t,{},e)},ft=function(t,e){ne.post("/user/remove/"+t,{},e)},ht=function(t,e){ne.post("/user/editPassword/"+t.id,{new_password:t.new_password,confirm_new_password:t.confirm_new_password},e)},_t=function(t,e){ne.post("/user/editMyPassword",t,e)},gt={name:"user-list",components:{taskSidebar:T},data:function(){return{users:[],userTotal:0,searchParams:{page_size:20,page:1,name:"",email:"",is_admin:""},searchTimer:null,isAdmin:this.$store.getters.user.isAdmin,pwdModalVisible:!1,pwdLoading:!1,pwdForm:{id:"",new_password:"",confirm_new_password:""},pwdRules:{new_password:[{required:!0,message:"请输入新密码",trigger:"blur"}],confirm_new_password:[{required:!0,message:"请再次输入新密码",trigger:"blur"}]},userModalVisible:!1,userLoading:!1,userForm:{id:"",name:"",email:"",is_admin:0,password:"",confirm_password:"",status:1},userRules:{name:[{required:!0,message:"请输入用户名",trigger:"blur"}],email:[{type:"email",required:!0,message:"请输入有效邮箱地址",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}],confirm_password:[{required:!0,message:"请再次输入密码",trigger:"blur"}]}}},created:function(){this.search()},beforeDestroy:function(){this.searchTimer&&clearTimeout(this.searchTimer)},methods:{debouncedSearch:function(){var t=this;this.searchTimer&&clearTimeout(this.searchTimer),this.searchTimer=setTimeout(function(){t.searchParams.page=1,t.search()},400)},changeStatus:function(t){t.status?mt(t.id):vt(t.id)},formatRoleLabel:function(t){return 1===t?"管理员":"普通用户"},changePage:function(t){this.searchParams.page=t,this.search()},changePageSize:function(t){this.searchParams.page_size=t,this.search()},search:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;ct(this.searchParams,function(a){t.users=a.data,t.userTotal=a.total,"function"==typeof e&&e()})},remove:function(t){var e=this;this.$appConfirm(function(){ft(t.id,function(){e.refresh()})})},refresh:function(){var t=this;this.search(function(){t.$message.success("刷新成功")})},openUserModal:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;e?ut(e.id,function(e){e?(t.userForm.id=e.id,t.userForm.name=e.name,t.userForm.email=e.email,t.userForm.is_admin=e.is_admin,t.userForm.status=e.status,t.userModalVisible=!0):t.$message.error("数据不存在")}):(this.userForm.id="",this.userModalVisible=!0)},resetUserForm:function(){this.userForm={id:"",name:"",email:"",is_admin:0,password:"",confirm_password:"",status:1},this.$refs.userForm&&this.$refs.userForm.resetFields()},submitUserForm:function(){var t=this;this.$refs.userForm.validate(function(e){e&&(t.userLoading=!0,dt(t.userForm,function(){t.userLoading=!1,t.userModalVisible=!1,t.$message.success("保存成功"),t.search()}))})},openPwdModal:function(t){this.pwdForm.id=t.id,this.pwdModalVisible=!0},resetPwdForm:function(){this.pwdForm={id:"",new_password:"",confirm_new_password:""},this.$refs.pwdForm&&this.$refs.pwdForm.resetFields()},submitPwd:function(){var t=this;this.$refs.pwdForm.validate(function(e){e&&(t.pwdLoading=!0,ht(t.pwdForm,function(){t.pwdLoading=!1,t.pwdModalVisible=!1,t.$message.success("密码修改成功")}))})}}},bt={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-container",[a("task-sidebar"),t._v(" "),a("el-main",{staticClass:"ios-user-page"},[a("div",{staticClass:"page-header"},[a("h2",{staticClass:"page-title"},[t._v("用户管理")])]),t._v(" "),a("div",{staticClass:"search-bar"},[a("div",{staticClass:"search-filters"},[a("el-input",{staticClass:"search-input",attrs:{placeholder:"用户名",clearable:""},on:{input:t.debouncedSearch},nativeOn:{keyup:function(e){if(!("button"in e)&&t._k(e.keyCode,"enter",13,e.key,"Enter"))return null;t.search()}},model:{value:t.searchParams.name,callback:function(e){t.$set(t.searchParams,"name","string"==typeof e?e.trim():e)},expression:"searchParams.name"}}),t._v(" "),a("el-input",{staticClass:"search-input",attrs:{placeholder:"邮箱",clearable:""},on:{input:t.debouncedSearch},nativeOn:{keyup:function(e){if(!("button"in e)&&t._k(e.keyCode,"enter",13,e.key,"Enter"))return null;t.search()}},model:{value:t.searchParams.email,callback:function(e){t.$set(t.searchParams,"email","string"==typeof e?e.trim():e)},expression:"searchParams.email"}}),t._v(" "),a("el-select",{staticClass:"search-select",attrs:{clearable:""},on:{change:t.debouncedSearch},model:{value:t.searchParams.is_admin,callback:function(e){t.$set(t.searchParams,"is_admin","string"==typeof e?e.trim():e)},expression:"searchParams.is_admin"}},[a("el-option",{attrs:{label:"全部角色",value:""}}),t._v(" "),a("el-option",{attrs:{label:"管理员",value:"2"}}),t._v(" "),a("el-option",{attrs:{label:"普通用户",value:"1"}})],1)],1),t._v(" "),a("div",{staticClass:"search-actions"},[a("el-button",{staticClass:"ios-action-btn",attrs:{type:"primary",plain:""},on:{click:function(e){t.openUserModal()}}},[t._v("新增用户")]),t._v(" "),a("el-button",{staticClass:"ios-action-btn",attrs:{type:"primary",plain:""},on:{click:t.refresh}},[t._v("刷新")])],1)]),t._v(" "),a("div",{staticClass:"ios-table-card"},[a("el-table",{staticClass:"ios-data-table",staticStyle:{width:"100%"},attrs:{data:t.users,"tooltip-effect":"dark"}},[a("el-table-column",{attrs:{prop:"id",label:"用户ID",width:"100"}}),t._v(" "),a("el-table-column",{attrs:{prop:"name",label:"用户名"}}),t._v(" "),a("el-table-column",{attrs:{prop:"email",label:"邮箱"}}),t._v(" "),a("el-table-column",{attrs:{label:"角色",width:"120"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",{staticClass:"ios-tag",class:{"ios-tag-admin":e.row.is_admin}},[t._v("\n              "+t._s(t.formatRoleLabel(e.row.is_admin))+"\n            ")])]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"状态",width:"100",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-switch",{attrs:{"active-value":1,"inactive-value":0,"active-color":"#13ce66","inactive-color":"#ff4949"},on:{change:function(a){t.changeStatus(e.row)}},model:{value:e.row.status,callback:function(a){t.$set(e.row,"status",a)},expression:"scope.row.status"}})]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"操作",width:"280"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",{staticClass:"action-buttons"},[a("el-button",{attrs:{type:"primary"},on:{click:function(a){t.openUserModal(e.row)}}},[t._v("编辑")]),t._v(" "),a("el-button",{attrs:{type:"success"},on:{click:function(a){t.openPwdModal(e.row)}}},[t._v("修改密码")]),t._v(" "),a("el-button",{attrs:{type:"danger"},on:{click:function(a){t.remove(e.row)}}},[t._v("删除")])],1)]}}])})],1)],1),t._v(" "),a("div",{staticClass:"pagination-wrap"},[a("el-pagination",{staticClass:"ios-pagination",attrs:{background:"",layout:"prev, pager, next, sizes, total",total:t.userTotal,"current-page":t.searchParams.page,"page-size":t.searchParams.page_size},on:{"size-change":t.changePageSize,"current-change":t.changePage,"prev-click":t.changePage,"next-click":t.changePage}})],1),t._v(" "),a("el-dialog",{attrs:{title:"修改密码",visible:t.pwdModalVisible,width:"420px","close-on-click-modal":!1,"append-to-body":!0,"custom-class":"pwd-dialog"},on:{"update:visible":function(e){t.pwdModalVisible=e},closed:t.resetPwdForm}},[a("el-form",{ref:"pwdForm",staticClass:"pwd-form",attrs:{model:t.pwdForm,rules:t.pwdRules,"label-width":"90px"}},[a("el-form-item",{attrs:{label:"新密码",prop:"new_password"}},[a("el-input",{attrs:{type:"password",placeholder:"请输入新密码","show-password":""},model:{value:t.pwdForm.new_password,callback:function(e){t.$set(t.pwdForm,"new_password",e)},expression:"pwdForm.new_password"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"确认密码",prop:"confirm_new_password"}},[a("el-input",{attrs:{type:"password",placeholder:"请再次输入新密码","show-password":""},model:{value:t.pwdForm.confirm_new_password,callback:function(e){t.$set(t.pwdForm,"confirm_new_password",e)},expression:"pwdForm.confirm_new_password"}})],1)],1),t._v(" "),a("span",{attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){t.pwdModalVisible=!1}}},[t._v("取消")]),t._v(" "),a("el-button",{attrs:{type:"primary",loading:t.pwdLoading},on:{click:t.submitPwd}},[t._v("保存")])],1)],1),t._v(" "),a("el-dialog",{attrs:{title:t.userForm.id?"编辑用户":"新增用户",visible:t.userModalVisible,width:"480px","close-on-click-modal":!1,"append-to-body":!0,"custom-class":"pwd-dialog"},on:{"update:visible":function(e){t.userModalVisible=e},closed:t.resetUserForm}},[a("el-form",{ref:"userForm",staticClass:"pwd-form",attrs:{model:t.userForm,rules:t.userRules,"label-width":"90px"}},[a("el-form-item",{attrs:{label:"用户名",prop:"name"}},[a("el-input",{attrs:{placeholder:"请输入用户名"},model:{value:t.userForm.name,callback:function(e){t.$set(t.userForm,"name","string"==typeof e?e.trim():e)},expression:"userForm.name"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"邮箱",prop:"email"}},[a("el-input",{attrs:{placeholder:"请输入邮箱"},model:{value:t.userForm.email,callback:function(e){t.$set(t.userForm,"email","string"==typeof e?e.trim():e)},expression:"userForm.email"}})],1),t._v(" "),t.userForm.id?t._e():[a("el-form-item",{attrs:{label:"密码",prop:"password"}},[a("el-input",{attrs:{type:"password",placeholder:"请输入密码","show-password":""},model:{value:t.userForm.password,callback:function(e){t.$set(t.userForm,"password",e)},expression:"userForm.password"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"确认密码",prop:"confirm_password"}},[a("el-input",{attrs:{type:"password",placeholder:"请再次输入密码","show-password":""},model:{value:t.userForm.confirm_password,callback:function(e){t.$set(t.userForm,"confirm_password",e)},expression:"userForm.confirm_password"}})],1)],t._v(" "),a("el-form-item",{attrs:{label:"角色",prop:"is_admin"}},[a("el-radio-group",{model:{value:t.userForm.is_admin,callback:function(e){t.$set(t.userForm,"is_admin",e)},expression:"userForm.is_admin"}},[a("el-radio",{attrs:{label:0}},[t._v("普通用户")]),t._v(" "),a("el-radio",{attrs:{label:1}},[t._v("管理员")])],1)],1),t._v(" "),a("el-form-item",{attrs:{label:"状态",prop:"status"}},[a("el-radio-group",{model:{value:t.userForm.status,callback:function(e){t.$set(t.userForm,"status",e)},expression:"userForm.status"}},[a("el-radio",{attrs:{label:1}},[t._v("启用")]),t._v(" "),a("el-radio",{attrs:{label:0}},[t._v("禁用")])],1)],1)],2),t._v(" "),a("span",{attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){t.userModalVisible=!1}}},[t._v("取消")]),t._v(" "),a("el-button",{attrs:{type:"primary",loading:t.userLoading},on:{click:t.submitUserForm}},[t._v("保存")])],1)],1)],1)],1)},staticRenderFns:[]};var kt=a("VU/8")(gt,bt,!1,function(t){a("sSzT")},"data-v-e02e2a10",null).exports,yt={name:"login",created:function(){this.$store.getters.user.token?this.$router.replace(this.$route.query.redirect||"/task"):"1"===this.$route.query.expired&&this.$message.warning("当前登录状态已失效，请重新登录")},data:function(){return{loading:!1,form:{username:"",password:""},formRules:{username:[{required:!0,message:"请输入用户名",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}]}}},methods:{submit:function(){var t=this;this.$refs.form.validate(function(e){if(!e)return!1;t.login()})},login:function(){var t=this;this.loading=!0,pt(this.form.username,this.form.password,function(e){t.loading=!1,t.$store.commit("setUser",{token:e.token,uid:e.uid,username:e.username,isAdmin:e.is_admin}),t.$message.success("登录成功"),t.$router.push(t.$route.query.redirect||"/")},function(){t.loading=!1})}}},wt={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"login-wrapper"},[t._m(0),t._v(" "),a("div",{staticClass:"login-center"},[a("div",{staticClass:"login-container"},[a("div",{staticClass:"login-card"},[t._m(1),t._v(" "),a("el-form",{ref:"form",staticClass:"login-form",attrs:{model:t.form,rules:t.formRules}},[a("div",{staticClass:"form-group"},[a("label",{staticClass:"input-label"},[t._v("用户名")]),t._v(" "),a("el-input",{attrs:{placeholder:"请输入用户名"},nativeOn:{keyup:function(e){return"button"in e||!t._k(e.keyCode,"enter",13,e.key,"Enter")?t.submit(e):null}},model:{value:t.form.username,callback:function(e){t.$set(t.form,"username","string"==typeof e?e.trim():e)},expression:"form.username"}},[a("span",{staticClass:"login-input-icon",attrs:{slot:"prefix"},slot:"prefix"},[a("svg",{attrs:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"}},[a("path",{attrs:{d:"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"}}),t._v(" "),a("circle",{attrs:{cx:"12",cy:"7",r:"4"}})])])])],1),t._v(" "),a("div",{staticClass:"form-group"},[a("label",{staticClass:"input-label"},[t._v("密码")]),t._v(" "),a("el-input",{attrs:{type:"password",placeholder:"请输入密码","show-password":""},nativeOn:{keyup:function(e){return"button"in e||!t._k(e.keyCode,"enter",13,e.key,"Enter")?t.submit(e):null}},model:{value:t.form.password,callback:function(e){t.$set(t.form,"password","string"==typeof e?e.trim():e)},expression:"form.password"}},[a("span",{staticClass:"login-input-icon",attrs:{slot:"prefix"},slot:"prefix"},[a("svg",{attrs:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"}},[a("rect",{attrs:{x:"3",y:"11",width:"18",height:"11",rx:"2",ry:"2"}}),t._v(" "),a("path",{attrs:{d:"M7 11V7a5 5 0 0 1 10 0v4"}})])])])],1),t._v(" "),a("el-button",{staticClass:"submit-btn",attrs:{type:"primary",loading:t.loading},on:{click:t.submit}},[t._v("立即登录")])],1)],1)])]),t._v(" "),a("div",{staticClass:"login-footer"},[a("p",{staticClass:"login-footer-line1"},[t._v(t._s((new Date).getFullYear())+" Copyright © Visionstar.cn, All Rights Reserved.")]),t._v(" "),t._m(2),t._v(" "),t._m(3)])])},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"login-background"},[e("div",{staticClass:"grad-circle grad-1"}),this._v(" "),e("div",{staticClass:"grad-circle grad-2"})])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"brand-section"},[e("img",{staticClass:"brand-logo",attrs:{src:"/static/logo.svg",alt:"Logo"}}),this._v(" "),e("h1",{staticClass:"brand-title"},[this._v("GoCron")]),this._v(" "),e("p",{staticClass:"brand-subtitle"},[this._v("剧星传媒 - 定时任务管理系统")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",{staticClass:"login-footer-line2"},[e("a",{staticClass:"login-footer-link",attrs:{href:"https://www.visionstar.cn/",target:"_blank",rel:"noopener noreferrer"}},[this._v("上海剧星传媒股份有限公司")]),this._v("版权所有")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",{staticClass:"login-footer-line3"},[e("a",{staticClass:"login-footer-link",attrs:{href:"https://beian.miit.gov.cn/",target:"_blank",rel:"noopener noreferrer"}},[this._v("沪ICP备12000756号-1")]),this._v(" "),e("span"),this._v(" "),e("a",{staticClass:"login-footer-link",attrs:{href:"https://beian.mps.gov.cn/#/query/webSearch",target:"_blank",rel:"noopener noreferrer"}},[this._v("沪公网安备31010702005097号")])])}]};var Ct=a("VU/8")(yt,wt,!1,function(t){a("PWLi")},"data-v-c5d5a714",null).exports,xt={name:"system-sidebar",components:{taskSidebar:T}},Tt={render:function(){var t=this.$createElement;return(this._self._c||t)("task-sidebar")},staticRenderFns:[]},Pt=a("VU/8")(xt,Tt,!1,null,null,null).exports,St={name:"notification-index",components:{systemSidebar:Pt},data:function(){return{activeTab:"email",saving:!1,mailForm:{host:"",port:465,user:"",password:"",template:""},mailReceivers:[],mailRules:{host:[{required:!0,message:"请输入SMTP服务器地址",trigger:"blur"}],port:[{required:!0,type:"number",message:"请输入有效的数字端口",trigger:"blur"}],user:[{required:!0,message:"请输入账户邮箱",trigger:"blur"}],password:[{required:!0,message:"请输入密码或授权码",trigger:"blur"}],template:[{required:!0,message:"请输入通知模板内容",trigger:"blur"}]},webhookForm:{url:"",template:""},webhookRules:{url:[{type:"url",required:!0,message:"请输入有效的通知 URL",trigger:"blur"}],template:[{required:!0,message:"请输入 Webhook 模板",trigger:"blur"}]},userModalVisible:!1,userForm:{username:"",email:""}}},created:function(){this.initData()},methods:{initData:function(){this.fetchMailConfig(),this.fetchWebhookConfig()},handleTabClick:function(t){},fetchMailConfig:function(){var t=this;j(function(e){t.mailForm.host=e.host,e.port&&(t.mailForm.port=e.port),t.mailForm.user=e.user,t.mailForm.password=e.password,t.mailForm.template=e.template,t.mailReceivers=e.mail_users})},saveMailConfig:function(){var t=this;this.$refs.mailForm.validate(function(e){e&&(t.saving=!0,H(t.mailForm,function(){t.saving=!1,t.$message.success("邮件服务器配置已保存"),t.fetchMailConfig()}))})},openUserModal:function(){this.userModalVisible=!0},resetUserForm:function(){this.userForm={username:"",email:""}},saveMailUser:function(){var t=this;if(!this.userForm.username||!this.userForm.email)return this.$message.error("请填写完整的用户信息");W(this.userForm,function(){t.userModalVisible=!1,t.$message.success("通知用户已添加"),t.fetchMailConfig()})},deleteMailUser:function(t){var e=this;this.$appConfirm(function(){B(t.id,function(){e.$message.success("用户已移除"),e.fetchMailConfig()})})},fetchWebhookConfig:function(){var t=this;Y(function(e){t.webhookForm.url=e.url,t.webhookForm.template=e.template})},saveWebhookConfig:function(){var t=this;this.$refs.webhookForm.validate(function(e){e&&(t.saving=!0,J(t.webhookForm,function(){t.saving=!1,t.$message.success("Webhook 配置已保存"),t.fetchWebhookConfig()}))})}}},Ft={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-container",[a("system-sidebar"),t._v(" "),a("el-main",[a("div",{staticClass:"page-header"},[a("h2",{staticClass:"page-title"},[t._v("通知配置")])]),t._v(" "),a("el-tabs",{staticClass:"ios-tabs",model:{value:t.activeTab,callback:function(e){t.activeTab=e},expression:"activeTab"}},[a("el-tab-pane",{attrs:{label:"邮件",name:"email"}},[a("div",{staticClass:"config-container"},[a("el-form",{ref:"mailForm",attrs:{model:t.mailForm,rules:t.mailRules,"label-width":"120px"}},[a("h3",{staticClass:"section-title"},[t._v("SMTP服务器配置")]),t._v(" "),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:14}},[a("el-form-item",{attrs:{label:"SMTP服务器",prop:"host"}},[a("el-input",{attrs:{placeholder:"例如: smtp.example.com"},model:{value:t.mailForm.host,callback:function(e){t.$set(t.mailForm,"host","string"==typeof e?e.trim():e)},expression:"mailForm.host"}})],1)],1),t._v(" "),a("el-col",{attrs:{span:10}},[a("el-form-item",{attrs:{label:"端口",prop:"port"}},[a("el-input",{attrs:{placeholder:"常见: 465, 587"},model:{value:t.mailForm.port,callback:function(e){t.$set(t.mailForm,"port",t._n(e))},expression:"mailForm.port"}})],1)],1)],1),t._v(" "),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"用户名",prop:"user"}},[a("el-input",{attrs:{placeholder:"邮箱账号"},model:{value:t.mailForm.user,callback:function(e){t.$set(t.mailForm,"user","string"==typeof e?e.trim():e)},expression:"mailForm.user"}})],1)],1),t._v(" "),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"密码",prop:"password"}},[a("el-input",{attrs:{type:"password",placeholder:"邮箱密码或授权码","show-password":""},model:{value:t.mailForm.password,callback:function(e){t.$set(t.mailForm,"password",e)},expression:"mailForm.password"}})],1)],1)],1),t._v(" "),a("el-alert",{staticStyle:{"margin-bottom":"20px"},attrs:{title:"通知模板支持html",type:"info",closable:!1}}),t._v(" "),a("el-form-item",{attrs:{label:"模板",prop:"template"}},[a("el-input",{attrs:{type:"textarea",rows:6,placeholder:"输入邮件通知模板..."},model:{value:t.mailForm.template,callback:function(e){t.$set(t.mailForm,"template",e)},expression:"mailForm.template"}})],1),t._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary",loading:t.saving},on:{click:t.saveMailConfig}},[t._v("保存邮件配置")])],1),t._v(" "),a("div",{staticClass:"divider"}),t._v(" "),a("div",{staticClass:"section-header"},[a("h3",{staticClass:"section-title"},[t._v("通知用户列表")]),t._v(" "),a("el-button",{attrs:{type:"primary",icon:"el-icon-plus"},on:{click:t.openUserModal}},[t._v("新增用户")])],1),t._v(" "),a("div",{staticClass:"tag-group"},[t._l(t.mailReceivers,function(e){return a("el-tag",{key:e.id,staticClass:"ios-tag",attrs:{closable:""},on:{close:function(a){t.deleteMailUser(e)}}},[a("span",{staticClass:"tag-main"},[t._v(t._s(e.username))]),t._v(" "),a("span",{staticClass:"tag-sub"},[t._v(t._s(e.email))])])}),t._v(" "),0===t.mailReceivers.length?a("div",{staticClass:"empty-tip"},[t._v("暂无通知用户")]):t._e()],2)],1)],1)]),t._v(" "),a("el-tab-pane",{attrs:{label:"Webhook",name:"webhook"}},[a("div",{staticClass:"config-container"},[a("el-form",{ref:"webhookForm",attrs:{model:t.webhookForm,rules:t.webhookRules,"label-width":"120px"}},[a("el-alert",{staticClass:"webhook-alert",attrs:{title:"通知内容推送到指定URL, POST请求, 设置Header[ Content-Type: application/json]",type:"info",closable:!1,"show-icon":""}}),t._v(" "),a("el-form-item",{attrs:{label:"URL",prop:"url"}},[a("el-input",{attrs:{placeholder:"https://api.yourdomain.com/callback"},model:{value:t.webhookForm.url,callback:function(e){t.$set(t.webhookForm,"url","string"==typeof e?e.trim():e)},expression:"webhookForm.url"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"模板",prop:"template"}},[a("el-input",{attrs:{type:"textarea",rows:8,placeholder:"输入JSON格式的模板..."},model:{value:t.webhookForm.template,callback:function(e){t.$set(t.webhookForm,"template","string"==typeof e?e.trim():e)},expression:"webhookForm.template"}})],1),t._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary",loading:t.saving},on:{click:t.saveWebhookConfig}},[t._v("保存Webhook配置")])],1)],1)],1)])],1),t._v(" "),a("div",{pre:!0,attrs:{class:"variable-guide"}},[a("h4",{attrs:{class:"guide-title"}},[a("i",{attrs:{class:"el-icon-info"}}),t._v(" 模板支持的变量参考")]),t._v(" "),a("div",{attrs:{class:"guide-content"}},[a("div",{attrs:{class:"v-item"}},[a("code",[t._v("{{.TaskId}}")]),a("span",[t._v("定时ID")])]),t._v(" "),a("div",{attrs:{class:"v-item"}},[a("code",[t._v("{{.TaskName}}")]),a("span",[t._v("定时名称")])]),t._v(" "),a("div",{attrs:{class:"v-item"}},[a("code",[t._v("{{.Status}}")]),a("span",[t._v("执行状态 (Success/Failure)")])]),t._v(" "),a("div",{attrs:{class:"v-item"}},[a("code",[t._v("{{.Result}}")]),a("span",[t._v("定时执行输出")])])])]),t._v(" "),a("el-dialog",{attrs:{title:"新增邮件通知用户",visible:t.userModalVisible,width:"400px","custom-class":"pwd-dialog","append-to-body":!0},on:{"update:visible":function(e){t.userModalVisible=e},closed:t.resetUserForm}},[a("el-form",{ref:"userForm",staticClass:"pwd-form",attrs:{model:t.userForm,"label-width":"80px"}},[a("el-form-item",{attrs:{label:"用户名"}},[a("el-input",{attrs:{placeholder:"用户姓名"},model:{value:t.userForm.username,callback:function(e){t.$set(t.userForm,"username","string"==typeof e?e.trim():e)},expression:"userForm.username"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"邮箱地址"}},[a("el-input",{attrs:{placeholder:"接收通知的邮箱"},model:{value:t.userForm.email,callback:function(e){t.$set(t.userForm,"email","string"==typeof e?e.trim():e)},expression:"userForm.email"}})],1)],1),t._v(" "),a("div",{attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){t.userModalVisible=!1}}},[t._v("取消")]),t._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:t.saveMailUser}},[t._v("确认新增")])],1)],1)],1)],1)},staticRenderFns:[]};var $t=a("VU/8")(St,Ft,!1,function(t){a("sI9w")},"data-v-712a78ed",null).exports,Lt={name:"index",data:function(){return{form:{db_type:"mysql",db_host:"127.0.0.1",db_port:3306,db_username:"",db_password:"",db_name:"",db_table_prefix:"",admin_username:"",admin_password:"",confirm_admin_password:"",admin_email:""},formRules:{db_type:[{required:!0,message:"请选择数据库",trigger:"blur"}],db_host:[{required:!0,message:"请输入数据库主机名",trigger:"blur"}],db_port:[{type:"number",required:!0,message:"请输入数据库端口",trigger:"blur"}],db_username:[{required:!0,message:"请输入数据库用户名",trigger:"blur"}],db_password:[{required:!0,message:"请输入数据库密码",trigger:"blur"}],db_name:[{required:!0,message:"请输入数据库名称",trigger:"blur"}],admin_username:[{required:!0,message:"请输入管理员账号",trigger:"blur"}],admin_email:[{type:"email",required:!0,message:"请输入管理员邮箱",trigger:"blur"}],admin_password:[{required:!0,message:"请输入管理员密码",trigger:"blur"},{min:6,message:"长度至少6个字符",trigger:"blur"}],confirm_admin_password:[{required:!0,message:"请再次输入管理员密码",trigger:"blur"},{min:6,message:"长度至少6个字符",trigger:"blur"}]},dbList:[{value:"mysql",label:"MySQL"},{value:"postgres",label:"PostgreSql"}],default_ports:{mysql:3306,postgres:5432}}},methods:{update_port:function(t){console.log(t),console.log(this.default_ports[t]),this.form.db_port=this.default_ports[t],console.log(this.form.db_port)},submit:function(){var t=this;this.$refs.form.validate(function(e){if(!e)return!1;t.save()})},save:function(){var t=this;le.store(this.form,function(){t.$router.push("/")})}}},Rt={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-container",[a("el-main",[a("el-form",{ref:"form",staticStyle:{width:"700px"},attrs:{model:t.form,rules:t.formRules,"label-width":"100px"}},[a("h3",[t._v("数据库配置")]),t._v(" "),a("el-form-item",{attrs:{label:"数据库选择",prop:"db_type"}},[a("el-select",{on:{change:t.update_port},model:{value:t.form.db_type,callback:function(e){t.$set(t.form,"db_type","string"==typeof e?e.trim():e)},expression:"form.db_type"}},t._l(t.dbList,function(t){return a("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})}))],1),t._v(" "),a("el-row",[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"主机名",prop:"db_host"}},[a("el-input",{model:{value:t.form.db_host,callback:function(e){t.$set(t.form,"db_host",e)},expression:"form.db_host"}})],1)],1),t._v(" "),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"端口",prop:"db_port"}},[a("el-input",{model:{value:t.form.db_port,callback:function(e){t.$set(t.form,"db_port",t._n(e))},expression:"form.db_port"}})],1)],1)],1),t._v(" "),a("el-row",[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"用户名",prop:"db_username"}},[a("el-input",{model:{value:t.form.db_username,callback:function(e){t.$set(t.form,"db_username",e)},expression:"form.db_username"}})],1)],1),t._v(" "),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"密码",prop:"db_password"}},[a("el-input",{attrs:{type:"password"},model:{value:t.form.db_password,callback:function(e){t.$set(t.form,"db_password",e)},expression:"form.db_password"}})],1)],1)],1),t._v(" "),a("el-row",[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"数据库名称",prop:"db_name"}},[a("el-input",{attrs:{placeholder:"如果数据库不存在, 需提前创建"},model:{value:t.form.db_name,callback:function(e){t.$set(t.form,"db_name",e)},expression:"form.db_name"}})],1)],1),t._v(" "),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"表前缀",prop:"db_table_prefix"}},[a("el-input",{model:{value:t.form.db_table_prefix,callback:function(e){t.$set(t.form,"db_table_prefix",e)},expression:"form.db_table_prefix"}})],1)],1)],1),t._v(" "),a("h3",[t._v("管理员账号配置")]),t._v(" "),a("el-row",[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"账号",prop:"admin_username"}},[a("el-input",{model:{value:t.form.admin_username,callback:function(e){t.$set(t.form,"admin_username",e)},expression:"form.admin_username"}})],1)],1),t._v(" "),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"邮箱",prop:"admin_email"}},[a("el-input",{model:{value:t.form.admin_email,callback:function(e){t.$set(t.form,"admin_email",e)},expression:"form.admin_email"}})],1)],1)],1),t._v(" "),a("el-row",[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"密码",prop:"admin_password"}},[a("el-input",{attrs:{type:"password"},model:{value:t.form.admin_password,callback:function(e){t.$set(t.form,"admin_password",e)},expression:"form.admin_password"}})],1)],1),t._v(" "),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"确认密码",prop:"confirm_admin_password"}},[a("el-input",{attrs:{type:"password"},model:{value:t.form.confirm_admin_password,callback:function(e){t.$set(t.form,"confirm_admin_password",e)},expression:"form.confirm_admin_password"}})],1)],1)],1),t._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:function(e){t.submit()}}},[t._v("安装")])],1)],1)],1)],1)},staticRenderFns:[]},Mt=a("VU/8")(Lt,Rt,!1,null,null,null).exports,Dt=function(t,e,a){ne.get("/system/login-log",t,e,a)},zt=function(t,e,a){ne.get("/system/login-log/users",t,e,a)},Vt=function(t,e,a){ne.get("/system/stats",t,e,a)},Et={name:"login-log",data:function(){return{logs:[],logTotal:0,searchParams:{page_size:20,page:1,username:"",ip:""},usernameOptions:[],usernameLoading:!1,searchTimer:null}},created:function(){this.searchUsernames(""),this.search()},beforeDestroy:function(){this.searchTimer&&clearTimeout(this.searchTimer)},components:{systemSidebar:Pt},methods:{debouncedSearch:function(){var t=this;this.searchTimer&&clearTimeout(this.searchTimer),this.searchTimer=setTimeout(function(){t.searchParams.page=1,t.search()},400)},searchUsernames:function(t){var e=this;this.usernameLoading=!0,zt({keyword:t},function(t){e.usernameOptions=Array.isArray(t)?t:[],e.usernameLoading=!1},function(){e.usernameLoading=!1})},changePage:function(t){this.searchParams.page=t,this.search()},changePageSize:function(t){this.searchParams.page_size=t,this.search()},search:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;Dt(this.searchParams,function(a){t.logs=a.data,t.logTotal=a.total,"function"==typeof e&&e()})},refresh:function(){var t=this;this.search(function(){t.$message.success("刷新成功")})}}},It={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-container",[a("system-sidebar"),t._v(" "),a("el-main",{staticClass:"ios-log-page"},[a("div",{staticClass:"search-bar"},[a("div",{staticClass:"page-title"},[t._v("登录日志")]),t._v(" "),a("div",{staticClass:"filter-row"},[a("div",{staticClass:"search-filters"},[a("el-select",{staticClass:"search-select",attrs:{filterable:"",clearable:"",remote:"","reserve-keyword":"",placeholder:"用户名","remote-method":t.searchUsernames,loading:t.usernameLoading},on:{change:function(e){t.search()}},model:{value:t.searchParams.username,callback:function(e){t.$set(t.searchParams,"username","string"==typeof e?e.trim():e)},expression:"searchParams.username"}},t._l(t.usernameOptions,function(t){return a("el-option",{key:t,attrs:{label:t,value:t}})})),t._v(" "),a("el-input",{staticClass:"search-input",attrs:{placeholder:"登录IP",clearable:""},on:{input:t.debouncedSearch},nativeOn:{keyup:function(e){if(!("button"in e)&&t._k(e.keyCode,"enter",13,e.key,"Enter"))return null;t.search()}},model:{value:t.searchParams.ip,callback:function(e){t.$set(t.searchParams,"ip","string"==typeof e?e.trim():e)},expression:"searchParams.ip"}})],1),t._v(" "),a("div",{staticClass:"search-actions"},[a("el-button",{staticClass:"ios-action-btn",attrs:{type:"primary",plain:""},on:{click:t.refresh}},[t._v("刷新")])],1)])]),t._v(" "),a("div",{staticClass:"ios-table-card"},[a("el-table",{ref:"table",staticClass:"ios-data-table",staticStyle:{width:"100%"},attrs:{data:t.logs}},[a("el-table-column",{attrs:{prop:"id",label:"ID"}}),t._v(" "),a("el-table-column",{attrs:{prop:"username",label:"用户名"}}),t._v(" "),a("el-table-column",{attrs:{prop:"ip",label:"登录IP"}}),t._v(" "),a("el-table-column",{attrs:{label:"登录时间"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n            "+t._s(t._f("formatTime")(e.row.created))+"\n          ")]}}])})],1)],1),t._v(" "),a("div",{staticClass:"pagination-wrap"},[a("el-pagination",{staticClass:"ios-pagination",attrs:{background:"",layout:"prev, pager, next, sizes, total",total:t.logTotal,"current-page":t.searchParams.page,"page-size":t.searchParams.page_size},on:{"size-change":t.changePageSize,"current-change":t.changePage,"prev-click":t.changePage,"next-click":t.changePage}})],1)])],1)},staticRenderFns:[]};var At=a("VU/8")(Et,It,!1,function(t){a("d9jj")},"data-v-b2ea1744",null).exports,Ut=a("Qf3D"),Ot=a("S+cJ"),qt=a("mCPF"),Nt=a("XReE"),jt=a("tJVo");Object(Ut.b)([Ot.a,qt.a,qt.b,Nt.b,Nt.e,Nt.c,Nt.d,Nt.a,jt.a]);function Ht(t){return t.getFullYear()+"-"+String(t.getMonth()+1).padStart(2,"0")+"-"+String(t.getDate()).padStart(2,"0")}function Wt(){var t=new Date,e=new Date;return e.setDate(t.getDate()-89),[Ht(e),Ht(t)]}function Bt(t,e,a){var s=Array.isArray(t)?t.slice():[];if(s.sort(function(t,e){return(e.value||0)-(t.value||0)}),s.length<=e)return s;var i=s.slice(0,e),r=s.slice(e).reduce(function(t,e){return t+(e.value||0)},0);return r>0&&i.push({name:a||"其他",value:r}),i}var Yt={name:"system-stats",components:{systemSidebar:Pt},data:function(){return{loading:!1,dateRange:Wt(),refreshTimer:null,datePickerOptions:{disabledDate:function(t){return t.getTime()>Date.now()}},chartMap:{},overview:{task_total:0,task_log_total:0,user_total:0,login_log_total:0},taskTagChart:[],taskLogDurationChart:[],taskLogStatusChart:[],loginUserChart:[],loginIpChart:[],pieColors:["#007aff","#5e5ce6","#34c759","#ff9f0a","#af52de","#30b0c7","#ff6b6b","#6d6d72","#00a9a5","#4e7cff","#b084f5","#53b97c"]}},mounted:function(){var t=this;this.loadStats(),this.onResize=function(){return t.resizeCharts()},window.addEventListener("resize",this.onResize)},beforeDestroy:function(){window.removeEventListener("resize",this.onResize),this.refreshTimer&&(clearTimeout(this.refreshTimer),this.refreshTimer=null),this.disposeCharts()},methods:{handleDateRangeChange:function(t){if(t&&2===t.length){var e=new Date(t[0]+" 00:00:00"),a=new Date(t[1]+" 00:00:00");if(Math.floor((a-e)/864e5)+1>365){this.$message.warning("时间范围最多支持1年");var s=new Date(t[1]+" 00:00:00"),i=new Date(s);i.setDate(i.getDate()-364),this.dateRange=[Ht(i),Ht(s)]}this.loadStats()}else this.dateRange=Wt()},handleRefresh:function(){var t=this;this.loading||(this.refreshTimer&&clearTimeout(this.refreshTimer),this.refreshTimer=setTimeout(function(){return t.loadStats()},180))},initCharts:function(){var t=this;["chartTaskTag","chartTaskLogDuration","chartTaskLogStatus","chartLoginUser","chartLoginIp"].forEach(function(e){var a=t.$refs[e];a&&(t.chartMap[e]||(t.chartMap[e]=Object(Ut.a)(a)))})},disposeCharts:function(){for(var t in this.chartMap)this.chartMap[t]&&this.chartMap[t].dispose();this.chartMap={}},resizeCharts:function(){for(var t in this.chartMap)this.chartMap[t]&&this.chartMap[t].resize()},setChartOption:function(t,e){this.chartMap[t]&&this.chartMap[t].setOption(e,!0)},buildEmptyOption:function(t){return{animation:!1,title:{text:t||"暂无数据",left:"center",top:"middle",textStyle:{color:"#8e8e93",fontSize:13,fontWeight:400}}}},buildPieOption:function(t){return t&&t.length?{color:this.pieColors,tooltip:{trigger:"item",formatter:"{b}: {c} ({d}%)"},legend:{type:"scroll",bottom:0,textStyle:{color:"#6d6d72",fontSize:10}},series:[{type:"pie",radius:["35%","68%"],center:["50%","42%"],label:{color:"#3a3a3c",fontSize:10,formatter:function(t){var e=String(t.name||"");return(e.length>8?e.slice(0,8)+"…":e)+"\n"+t.percent+"%"}},itemStyle:{borderWidth:1,borderColor:"#ffffff"},data:t}]}:this.buildEmptyOption("暂无数据")},buildBarOption:function(t){return t&&t.length?{color:["#007aff"],tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},dataZoom:t.length>8?[{type:"inside",xAxisIndex:0,start:0,end:70},{type:"slider",xAxisIndex:0,height:14,bottom:30,start:0,end:70}]:[],grid:{left:20,right:16,top:10,bottom:62,containLabel:!0},xAxis:{type:"category",data:t.map(function(t){return t.name}),axisLabel:{interval:0,rotate:25,color:"#6d6d72",fontSize:10,formatter:function(t){var e=String(t||"");return e.length>10?e.slice(0,10)+"…":e}},axisTick:{show:!1},axisLine:{lineStyle:{color:"#d2d2d7"}}},yAxis:{type:"value",minInterval:1,axisLabel:{color:"#6d6d72",fontSize:10},splitLine:{lineStyle:{color:"#f0f0f2"}}},series:[{type:"bar",data:t.map(function(t){return t.value}),barWidth:"48%",itemStyle:{borderRadius:[6,6,0,0]}}]}:this.buildEmptyOption("暂无数据")},renderCharts:function(){var t=this;this.$nextTick(function(){t.initCharts(),t.setChartOption("chartTaskTag",t.buildBarOption(t.taskTagChart)),t.setChartOption("chartTaskLogDuration",t.buildPieOption(t.taskLogDurationChart)),t.setChartOption("chartTaskLogStatus",t.buildPieOption(t.taskLogStatusChart)),t.setChartOption("chartLoginUser",t.buildPieOption(t.loginUserChart)),t.setChartOption("chartLoginIp",t.buildPieOption(t.loginIpChart)),t.resizeCharts()})},loadStats:function(){var t=this;this.dateRange&&2===this.dateRange.length||(this.dateRange=Wt()),this.loading=!0,Vt({start_time:this.dateRange[0],end_time:this.dateRange[1]},function(e){t.overview=e&&e.overview_all?e.overview_all:t.overview,t.taskTagChart=Bt(e&&e.task_tag||[],9,"其他标签"),t.taskLogDurationChart=e&&e.task_log_duration||[],t.taskLogStatusChart=e&&e.task_log_status||[],t.loginUserChart=Bt(e&&e.login_user||[],9,"其他用户"),t.loginIpChart=Bt(e&&e.login_ip||[],9,"其他IP"),t.loading=!1,t.renderCharts()},function(){t.loading=!1})}}},Jt={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-container",[a("system-sidebar"),t._v(" "),a("el-main",{staticClass:"stats-page"},[a("div",{staticClass:"stats-header"},[a("div",[a("h2",{staticClass:"stats-title"},[t._v("统计")]),t._v(" "),a("p",{staticClass:"stats-subtitle"},[t._v("按时间范围聚合统计（默认最近3个月）")])]),t._v(" "),a("div",{staticClass:"stats-actions"},[a("el-button",{staticClass:"ios-action-btn",attrs:{type:"primary",plain:"",disabled:t.loading},on:{click:t.handleRefresh}},[a("i",{staticClass:"el-icon-refresh",class:{"is-loading":t.loading}}),t._v("\n          刷新\n        ")])],1)]),t._v(" "),a("div",{staticClass:"stats-overview"},[a("div",{staticClass:"overview-item"},[a("div",{staticClass:"overview-label"},[t._v("定时总数")]),t._v(" "),a("div",{staticClass:"overview-value"},[t._v(t._s(t.overview.task_total))])]),t._v(" "),a("div",{staticClass:"overview-item"},[a("div",{staticClass:"overview-label"},[t._v("定时日志")]),t._v(" "),a("div",{staticClass:"overview-value"},[t._v(t._s(t.overview.task_log_total))])]),t._v(" "),a("div",{staticClass:"overview-item"},[a("div",{staticClass:"overview-label"},[t._v("用户总数")]),t._v(" "),a("div",{staticClass:"overview-value"},[t._v(t._s(t.overview.user_total))])]),t._v(" "),a("div",{staticClass:"overview-item"},[a("div",{staticClass:"overview-label"},[t._v("登录日志")]),t._v(" "),a("div",{staticClass:"overview-value"},[t._v(t._s(t.overview.login_log_total))])])]),t._v(" "),a("div",{staticClass:"stats-filter-bar"},[a("span",{staticClass:"filter-label"},[t._v("时间筛选")]),t._v(" "),a("el-date-picker",{attrs:{type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"yyyy-MM-dd",clearable:!1,"picker-options":t.datePickerOptions},on:{change:t.handleDateRangeChange},model:{value:t.dateRange,callback:function(e){t.dateRange=e},expression:"dateRange"}})],1),t._v(" "),a("section",{staticClass:"stats-section"},[a("h3",{staticClass:"section-title"},[t._v("所有定时")]),t._v(" "),a("div",{staticClass:"chart-grid chart-grid-single"},[a("div",{staticClass:"chart-card"},[a("div",{staticClass:"card-title"},[t._v("标签分布")]),t._v(" "),a("div",{ref:"chartTaskTag",staticClass:"chart-box"})])])]),t._v(" "),a("section",{staticClass:"stats-section"},[a("h3",{staticClass:"section-title"},[t._v("定时日志")]),t._v(" "),a("div",{staticClass:"chart-grid"},[a("div",{staticClass:"chart-card"},[a("div",{staticClass:"card-title"},[t._v("耗时分布")]),t._v(" "),a("div",{ref:"chartTaskLogDuration",staticClass:"chart-box"})]),t._v(" "),a("div",{staticClass:"chart-card"},[a("div",{staticClass:"card-title"},[t._v("日志状态分布")]),t._v(" "),a("div",{ref:"chartTaskLogStatus",staticClass:"chart-box"})])])]),t._v(" "),a("section",{staticClass:"stats-section"},[a("h3",{staticClass:"section-title"},[t._v("用户与登录")]),t._v(" "),a("div",{staticClass:"chart-grid"},[a("div",{staticClass:"chart-card"},[a("div",{staticClass:"card-title"},[t._v("用户登录次数")]),t._v(" "),a("div",{ref:"chartLoginUser",staticClass:"chart-box"})]),t._v(" "),a("div",{staticClass:"chart-card"},[a("div",{staticClass:"card-title"},[t._v("登录IP分布")]),t._v(" "),a("div",{ref:"chartLoginIp",staticClass:"chart-box"})])])])])],1)},staticRenderFns:[]};var Gt=a("VU/8")(Yt,Jt,!1,function(t){a("ZArF")},"data-v-04860174",null).exports;s.default.use(p.a);var Zt=new p.a({mode:"hash",routes:[{path:"*",component:y,meta:{title:"404",noLogin:!0,noNeedAdmin:!0}},{path:"/",redirect:"/task"},{path:"/install",name:"install",component:Mt,meta:{title:"安装",noLogin:!0,noNeedAdmin:!0}},{path:"/task",name:"task-list",component:N,meta:{title:"任务管理",noNeedAdmin:!0}},{path:"/task/create",name:"task-create",component:Q,meta:{title:"新增任务"}},{path:"/task/edit/:id",name:"task-edit",component:Q,meta:{title:"编辑任务"}},{path:"/task/log",name:"task-log",component:et,meta:{title:"定时日志",noNeedAdmin:!0}},{path:"/host",name:"host-list",component:lt,meta:{title:"节点管理",noNeedAdmin:!0}},{path:"/user",name:"user-list",component:kt,meta:{title:"用户管理"}},{path:"/user/login",name:"user-login",component:Ct,meta:{title:"登录",noLogin:!0}},{path:"/system",redirect:"/system/notification"},{path:"/system/notification/email",redirect:"/system/notification"},{path:"/system/notification/slack",redirect:"/system/notification"},{path:"/system/notification/webhook",redirect:"/system/notification"},{path:"/system/notification",name:"notification",component:$t,meta:{title:"通知配置"}},{path:"/system/login-log",name:"login-log",component:At,meta:{title:"登录日志"}},{path:"/system/stats",name:"system-stats",component:Gt,meta:{title:"统计"}}]});Zt.beforeEach(function(t,e,a){if(t.meta.title&&(document.title=t.meta.title+" - 定时任务系统 - 剧星传媒"),t.meta.noLogin)a();else{if(b.getters.user.token){if(b.getters.user.isAdmin||t.meta.noNeedAdmin)return void a();if(!b.getters.user.isAdmin)return void a({path:"/404.html"})}a({path:"/user/login",query:{redirect:t.fullPath}})}});var Kt=Zt,Qt=a("mw3O"),Xt=a.n(Qt),te=0,ee=401,ae=801;function se(){b.commit("logout"),Kt.currentRoute&&"/user/login"===Kt.currentRoute.path||Kt.push({path:"/user/login",query:{redirect:Kt.currentRoute&&Kt.currentRoute.fullPath||"/",expired:"1"}})}function ie(t,e,a){t.then(function(t){return function(t,e,a){if(!t||!t.data)return i.Message.error({message:"响应数据异常"}),void("function"==typeof a&&a(null,"响应数据异常"));var s=t.data;if(!re(s.code,s.message))return void("function"==typeof a&&a(s.code,s.message));if(!e)return;e(s.data,s.code,s.message)}(t,e,a)}).catch(function(t){"function"==typeof a&&a(t),oe(t)})}function re(t,e){if(void 0===t||null===t)return i.Message.error({message:e||"响应格式异常"}),!1;switch(t){case ae:return Kt.push("/install"),!1;case ee:return se(),!1}return t===te||(i.Message.error({message:e}),!1)}function oe(t){var e=t&&t.response&&t.response.data&&t.response.data.code;if(e!==ee&&e!==ae){var a=t&&(t.message||t.toString&&t.toString())?t.message||t.toString():"网络异常";i.Message.error({message:"请求失败 - "+a})}}d.a.defaults.baseURL="/api",d.a.defaults.timeout=1e5,d.a.defaults.responseType="json",d.a.interceptors.request.use(function(t){return t.headers["Auth-Token"]=b.getters.user.token,t},function(t){return i.Message.error({message:"加载失败, 请稍后再试"}),c.a.reject(t)}),d.a.interceptors.response.use(function(t){return t},function(t){if(t&&t.response&&t.response.data){var e=t.response.data;if(e.code===ee)return se(),c.a.reject(t);if(e.code===ae)return Kt.push("/install"),c.a.reject(t)}var a=t&&t.response&&t.response.data&&t.response.data.code;return a!==ee&&a!==ae&&i.Message.error({message:"加载失败, 请稍后再试"}),c.a.reject(t)});var ne={get:function(t,e,a,s){ie(d.a.get(t,{params:e}),a,s)},batchGet:function(t,e,a){var s=[],r=!0,o=!1,l=void 0;try{for(var c,u=n()(t);!(r=(c=u.next()).done);r=!0){var p=c.value,m={};void 0!==p.params&&(m=p.params),s.push(d.a.get(p.uri,{params:m}))}}catch(t){o=!0,l=t}finally{try{!r&&u.return&&u.return()}finally{if(o)throw l}}d.a.all(s).then(d.a.spread(function(){for(var t=[],a=arguments.length,s=Array(a),r=0;r<a;r++)s[r]=arguments[r];var o=!0,l=!1,c=void 0;try{for(var u,d=n()(s);!(o=(u=d.next()).done);o=!0){var p=u.value;if(!p||!p.data)return void i.Message.error({message:"响应数据异常"});if(!re(p.data.code,p.data.message))return;t.push(p.data.data)}}catch(t){l=!0,c=t}finally{try{!o&&d.return&&d.return()}finally{if(l)throw c}}"function"==typeof e&&e.apply(void 0,t)})).catch(function(t){"function"==typeof a&&a(t),oe(t)})},post:function(t,e,a,s){ie(d.a.post(t,Xt.a.stringify(e),{headers:{post:{"Content-Type":"application/x-www-form-urlencoded"}}}),a,s)}},le={store:function(t,e){ne.post("/install/store",t,e)},status:function(t){ne.get("/install/status",{},t)}},ce={name:"app-header",data:function(){return{dropdownOpen:!1,pwdModalVisible:!1,pwdLoading:!1,pwdForm:{old_password:"",new_password:"",confirm_new_password:""},pwdRules:{old_password:[{required:!0,message:"请输入原密码",trigger:"blur"}],new_password:[{required:!0,message:"请输入新密码",trigger:"blur"}],confirm_new_password:[{required:!0,message:"请再次输入新密码",trigger:"blur"}]}}},computed:{usernameInitial:function(){return(this.$store.getters.user.username||"").charAt(0).toUpperCase()}},methods:{toggleDropdown:function(){this.dropdownOpen=!this.dropdownOpen},openPwdModal:function(){this.dropdownOpen=!1,this.pwdModalVisible=!0},resetPwdForm:function(){this.pwdForm={old_password:"",new_password:"",confirm_new_password:""},this.$refs.pwdForm&&this.$refs.pwdForm.resetFields()},submitPwd:function(){var t=this;this.$refs.pwdForm.validate(function(e){e&&(t.pwdLoading=!0,_t(t.pwdForm,function(){t.pwdLoading=!1,t.pwdModalVisible=!1,t.$message.success("密码修改成功")}))})},logout:function(){this.dropdownOpen=!1,this.$store.commit("logout"),this.$router.push("/user/login")},handleOutsideClick:function(t){this.$refs.userBtn&&!this.$refs.userBtn.contains(t.target)&&(this.dropdownOpen=!1)}},mounted:function(){document.addEventListener("click",this.handleOutsideClick)},beforeDestroy:function(){document.removeEventListener("click",this.handleOutsideClick)}},ue={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"ios-header"},[a("div",{staticClass:"ios-nav"},[t._m(0),t._v(" "),a("div",{staticClass:"ios-nav-spacer"}),t._v(" "),t.$store.getters.user.token?a("div",{staticClass:"ios-user-area"},[a("div",{ref:"userBtn",staticClass:"ios-avatar-btn",on:{click:t.toggleDropdown}},[a("span",{staticClass:"ios-avatar-icon"},[t._v(t._s(t.usernameInitial))]),t._v(" "),a("span",{staticClass:"ios-username"},[t._v(t._s(t.$store.getters.user.username))]),t._v(" "),a("span",{staticClass:"ios-chevron",class:{open:t.dropdownOpen}},[t._v("›")])]),t._v(" "),a("transition",{attrs:{name:"ios-dropdown-fade"}},[t.dropdownOpen?a("div",{staticClass:"ios-dropdown"},[a("div",{staticClass:"ios-dropdown-item",on:{click:t.openPwdModal}},[t._v("修改密码")]),t._v(" "),a("div",{staticClass:"ios-dropdown-divider"}),t._v(" "),a("div",{staticClass:"ios-dropdown-item danger",on:{click:t.logout}},[t._v("退出登录")])]):t._e()])],1):t._e()]),t._v(" "),a("el-dialog",{attrs:{title:"修改密码",visible:t.pwdModalVisible,width:"420px","close-on-click-modal":!1,"append-to-body":!0,"custom-class":"pwd-dialog"},on:{"update:visible":function(e){t.pwdModalVisible=e},closed:t.resetPwdForm}},[a("el-form",{ref:"pwdForm",staticClass:"pwd-form",attrs:{model:t.pwdForm,rules:t.pwdRules,"label-width":"90px"}},[a("el-form-item",{attrs:{label:"原密码",prop:"old_password"}},[a("el-input",{attrs:{type:"password",placeholder:"请输入原密码","show-password":""},model:{value:t.pwdForm.old_password,callback:function(e){t.$set(t.pwdForm,"old_password",e)},expression:"pwdForm.old_password"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"新密码",prop:"new_password"}},[a("el-input",{attrs:{type:"password",placeholder:"请输入新密码","show-password":""},model:{value:t.pwdForm.new_password,callback:function(e){t.$set(t.pwdForm,"new_password",e)},expression:"pwdForm.new_password"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"确认密码",prop:"confirm_new_password"}},[a("el-input",{attrs:{type:"password",placeholder:"请再次输入新密码","show-password":""},model:{value:t.pwdForm.confirm_new_password,callback:function(e){t.$set(t.pwdForm,"confirm_new_password",e)},expression:"pwdForm.confirm_new_password"}})],1)],1),t._v(" "),a("span",{attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){t.pwdModalVisible=!1}}},[t._v("取消")]),t._v(" "),a("el-button",{attrs:{type:"primary",loading:t.pwdLoading},on:{click:t.submitPwd}},[t._v("保存")])],1)],1)],1)},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"ios-brand",attrs:{title:"剧星传媒 - 定时任务系统"}},[e("img",{staticClass:"ios-brand-logo",attrs:{src:"/static/logo.svg",alt:"logo"}})])}]};var de={render:function(){var t=this.$createElement;return(this._self._c||t)("div")},staticRenderFns:[]},pe={name:"App",data:function(){return{}},computed:{isLoginPage:function(){return"/user/login"===this.$route.path}},created:function(){var t=this;le.status(function(e){e||t.$router.push("/install")})},components:{appHeader:a("VU/8")(ce,ue,!1,function(t){a("Eyp0"),a("wti7")},"data-v-48cb2361",null).exports,appFooter:a("VU/8")({name:"app-footer",data:function(){return{}}},de,!1,null,null,null).exports}},me={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{attrs:{id:"app-root"}},[this.isLoginPage?this._e():e("app-header"),this._v(" "),e("div",{attrs:{id:"app-body"}},[e("router-view")],1),this._v(" "),this.isLoginPage?this._e():e("app-footer")],1)},staticRenderFns:[]};var ve=a("VU/8")(pe,me,!1,function(t){a("egPU")},null,null).exports;s.default.config.productionTip=!1,s.default.use(r.a,{size:"mini"}),s.default.directive("focus",{inserted:function(t){t.focus()}}),s.default.prototype.$appConfirm=function(t){this.$confirm("确定执行此操作?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){t()})},s.default.filter("formatTime",function(t){var e=function(t){return t>=10?t:"0"+t},a=new Date(t),s=a.getFullYear()+"-"+e(a.getMonth()+1)+"-"+e(a.getDate())+" "+e(a.getHours())+":"+e(a.getMinutes())+":"+e(a.getSeconds());return 0!==s.indexOf("20")?"":s}),new s.default({el:"#app",router:Kt,store:b,components:{App:ve},template:"<App/>"})},PWLi:function(t,e){},R8Fp:function(t,e){},ZArF:function(t,e){},d9jj:function(t,e){},egPU:function(t,e){},sI9w:function(t,e){},sSzT:function(t,e){},sz0f:function(t,e){},tvR6:function(t,e){},wfK6:function(t,e){},wti7:function(t,e){}},["NHnr"]);